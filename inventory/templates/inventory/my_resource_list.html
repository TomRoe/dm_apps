{% extends "inventory/inventory_base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}
{% load i18n %}
{% block content %}

    <div class="container-fluid">
        <div class="text-center">
            <h1>{{ user.first_name }}'s Metadata List:</h1>
            <h4><a href="{% url 'inventory:person_edit' user.id %}">(Click here to edit your personal details)</a></h4>
        </div>

        <a href="{% url 'inventory:resource_new' %}" class="btn btn-sm btn-primary float-right">New Resource</a>
        <table class="table table-hover table-sm sortable">
            <thead>
            <th scope="col">#</th>
            <th scope="col" style="max-width: 30%">
                {% trans "Title" %}
            </th>
            <th scope="col">
                {% trans "Status" %}
            </th>
            <th scope="col">
                {% trans "Section" %}
            </th>
            <th scope="col">
                {% trans "Role(s)" %}
            </th>
            <th scope="col">
                {% trans "Previous time certified" %}
            </th>
            <th scope="col">
                {% trans "Completedness Rating" %}
            </th>
            <th scope="col">
                {% trans "Published to Open Data?" %}
            </th>
            <th scope="col" colspan="2">
                {% trans "External Links" %}
            </th>
            </thead>
            <tbody>
            {% for obj in object_list %}
                <tr href="{% url 'inventory:resource_detail' obj.id %}">
                    <td>{{ forloop.counter }}</td>
                    <td>{{ obj.title_eng }}</td>

                    {% if obj.status.id == 3 %}
                        <td class="green-font">

                            {% elif obj.status.id == 1 %}
                        <td class="red-font">
                            {% else %}
                        <td>

                    {% endif %}
                    {{ obj.status }}
                    </td>
                    <td>{{ obj.section.name }}</td>
                    <td>
                        {% for person in obj.resource_people.all %}
                            {% if person.person.user_id == user.id %}
                                {% if person.role.id == 1 %}
                                    <b>{{ person.role }}</b>;
                                {% else %}
                                    {{ person.role }};
                                {% endif %}

                            {% endif %}
                        {% endfor %}

                    </td>
                    {% if obj.certification_history.count > 0 %}
                        {% if now|timedelta:obj.certification_history.first.certification_date < 90 %}
                            <td class="good">
                                {% elif now|timedelta:obj.certification_history.first.certification_date < 180 %}
                            <td class="mild-concern">

                                {% elif now|timedelta:obj.certification_history.first.certification_date < 270 %}
                            <td class="concern">
                                {% else %}
                            <td class="bad">
                        {% endif %}
                    {{ obj.certification_history.first.certification_date|naturaltime }}
                    {% else %}
                        <td><span class="red-font"><b>Never</b></span>
                    {% endif %}
                    </td>
                    <td>{{ obj.completedness_rating|percentage:0 }}</td>
                    <td>
                        {{ obj.fgp_publication_date|yesno:"yes,no,no" }}
                    </td>
                    <td>
                        {% if obj.fgp_url %}
                            <a class="stop-blank" href="{{ obj.fgp_url }}" data-toggle="tooltip"
                               title="Open URL in the Federal Geospatial Platform">
                                <img src="{% static 'img/icons/fgp.png' %}" alt="" width="25px">
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        {% if obj.public_url %}
                            <a class="stop-blank" href="{{ obj.public_url }}" data-toggle="tooltip"
                               title="Open URL in the Open Government Portal">
                                <img src="{% static 'img/icons/canada.png' %}" alt="" width="25px">
                            </a>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <b>
            TOTAL: {{ object_list.count }}
        </b>

    </div>

{% endblock content %}
