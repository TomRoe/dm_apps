{% extends "inventory/inventory_base.html" %}
{% load static %}
{% load humanize %}
{% block content %}
{% load timedelta %}

<div class="container text-center">

  <p>
    <h1>{{user.first_name}}'s Data Resource List:</h1>
  </p>
</div>
<div class="indent-med">

  <a href="{% url 'inventory:resource_new' %}" class="btn btn btn-primary float-right">New Resource</a>
  <h3>Custodian:</h3>
  <table class="table table-hover table-sm">
    <thead>
        <th scope="col">#</th>
        <th scope="col" >Title</th>
        <th scope="col">Status</th>
        <th scope="col">Section</th>
        <th scope="col">Role(s)</th>
        <th scope="col">Previous time certified</th>
      </tr>
    </thead>
    <tbody>
      {% for obj in custodian_list  %}
        <tr>
          <td>{{forloop.counter}}</td>
          <td><a href="{% url 'inventory:resource_detail' obj.resource.id %}">{{obj.resource.title_eng}}</a></td>

          {% if obj.resource.status.id == 3 %}
          <td class="green-font">

          {% elif obj.resource.status.id == 1 %}
          <td class="red-font">
          {% else %}
          <td>

          {% endif %}
            {{obj.resource.status}}
          </td>

          <td>{{obj.resource.section.section}}</td>

          <td>
            {% for person in obj.resource.resource_people.all %}
                {% if person.person.user_id == user.id %}
                  {% if person.role.id == 1 %}
                  <b>{{person.role}}</b>;
                  {% else %}
                  {{person.role}};
                  {% endif %}

                {% endif %}
            {% endfor %}

          </td>

            {% if obj.resource.certification_history.count > 0 %}

            {% if now|timedelta:obj.resource.certification_history.first.certification_date < 90 %}
            <td class="good">
            {% elif now|timedelta:obj.resource.certification_history.first.certification_date < 180 %}
            <td class="mild-concern">

            {% elif now|timedelta:obj.resource.certification_history.first.certification_date < 270 %}
            <td class="concern">
            {% else %}
            <td class="bad">
            {% endif %}
            {{obj.resource.certification_history.first.certification_date|naturaltime}}
            {% else %}
            <td><span class="red-font"><b>Never</b></span>
            {% endif %}

          </td>

        </tr>
      {% endfor %}
      <br>

      </tbody>
    </table>

<br>
    <h3>Other roles:</h3>
    {% if not non_custodian_list %}
    <em>There are no data resources with you listed in other roles</em>
    {% else %}

    <table class="table table-hover table-sm">
      <thead>
        <th scope="col">#</th>
        <th scope="col">Title</th>
        <th scope="col">Status</th>
        <th scope="col">Section</th>
        <th scope="col">Role(s)</th>
        <th scope="col">Previous time certified</th>
      </tr>
    </thead>
    <tbody>
      {% for obj in non_custodian_list  %}
      <tr>
        <td>{{forloop.counter}}</td>
        <td><a href="{% url 'inventory:resource_detail' obj.id %}">{{obj.title_eng}}</a></td>

        {% if obj.status.id == 3 %}
        <td class="green-font">

          {% elif obj.status.id == 1 %}
          <td class="red-font">
            {% else %}
            <td>

              {% endif %}
              {{obj.status}}
            </td>

            <td>{{obj.section.section}}</td>

            <td>
              {% for person in obj.resource_people.all %}
              {% if person.person.user_id == user.id %}
              {% if person.role.id == 1 %}
              <b>{{person.role}}</b>;
              {% else %}
              {{person.role}};
              {% endif %}

              {% endif %}
              {% endfor %}

            </td>




              {% if obj.certification_history.count > 0 %}

              {% if now|timedelta:obj.certification_history.first.certification_date < 90 %}
              <td class="good">
              {% elif now|timedelta:obj.certification_history.first.certification_date < 180 %}
              <td class="mild-concern">

              {% elif now|timedelta:obj.certification_history.first.certification_date < 270 %}
              <td class="concern">
              {% else %}
              <td class="bad">
              {% endif %}
              {{obj.certification_history.first.certification_date|naturaltime}}
              {% else %}
              <span class="red-font"><b>Never</b></span>
              {% endif %}

            </td>

            </tr>
            {% endfor %}
            <br>

          </tbody>
        </table>


    {% endif %}


 {{id_list}}
  </div>

{% endblock content %}
