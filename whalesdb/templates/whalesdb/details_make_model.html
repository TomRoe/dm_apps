{% extends "whalesdb/whale_base.html" %}
{% load bootstrap4 %}
{% load static %}
{% load i18n %}
{% bootstrap_css %}
{% load verbose_names %}

{% block title %}
    {% trans title %}
{% endblock title %}

{% block body %}
<div class="container container-fluid">
    <div>
        <table class="table table-sm table-striped">
            {% if objects %}
                {% for o in objects %}
                    {% for f in o.fields %}
                        <tr><th>{{ f.label }}</th><td>{% get_field_value o.object f.key %}</td></tr>
                    {% endfor %}
                {% endfor %}
            {% else %}
                {% for f in fields %}
                    <tr><th>{{ f.label }}</th><td>{% get_field_value object f.key %}</td></tr>
                {% endfor %}
            {% endif %}
        </table>

        <div class="row">
            <div class="col-1"><a class="btn btn-primary" href="#"
                    onclick="return popitup('{% url 'whalesdb:create_parameter' 'pop' object.pk %}','popoutWindow')"
                    title="{% trans 'Add Parameter'%}">+</a>
            </div>
            <div>
                <h3>{% trans 'Parameters' %}</h3>
            </div>
        </div>
        <table class="table table-sm table-striped">
            {% for p in parameter %}
            <tr>
                <td class="col-1">
                    <a class="pm-delete-me" href="#" val="{{ p.prm_id }}">
                    <img src="{% static '/admin/img/icon-deletelink.svg' %}" data-toggle="tooltip" title="Delete">
                    </a>
                    <a id="pm-secrect-delete-btn-{{ p.prm_id }}"
                       href="{% url 'whalesdb:delete_parameter' url object.pk p.prm_id %}" class="hidden"></a>

                </td>
                {% for f in parameter_fields %}
                <td>{% get_field_value p f.key %}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>


        {% if channel_fields %}
        <div class="row">
            <div class="col-1"><a class="btn btn-primary" href="#"
                            onclick="return popitup('{% url 'whalesdb:create_channel' 'pop' object.pk %}','popoutWindow')"
                            title="{% trans 'Add Channel'%}">+</a>
            </div>
            <div>
                <h3>{% trans 'Channels' %}</h3>
            </div>
        </div>
        <table class="table table-sm table-striped">
            <tr>
                <th class="col-1"><!-- leave blank --></th>
                {% for f in channel_fields %}
                <th>{{ f.label }}</th>
                {% endfor %}
            </tr>
            {% for c in channels %}
            <tr>
                <td>
                    <a class="cm-delete-me" href="#" val="{{ c.ecp_id }}">
                    <img src="{% static '/admin/img/icon-deletelink.svg' %}" data-toggle="tooltip" title="Delete">
                    </a>
                    <a id="cm-secrect-delete-btn-{{ c.ecp_id }}"
                       href="{% url 'whalesdb:delete_channel' c.ecp_id %}" class="hidden"></a>

                </td>
                {% for f in channel_fields %}
                <td>{% get_field_value c f.key %}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>

        {% endif %}

    </div>
</div>
{% endblock body %}

{% block body_js %}
    <script type="application/javascript">

        $(".pm-delete-me").click(function (e) {
            var objectId = $(this)[0].getAttribute("val");

            var userInput = "";
            userInput = confirm("{% trans "Are you sure you want to delete this parameter from the make and model object?" %}");
            if (userInput === true) {
                document.location.href = $("#pm-secrect-delete-btn-" + objectId)[0].getAttribute("href");
            }
            e.stopImmediatePropagation();
        });

        $(".cm-delete-me").click(function (e) {
            var objectId = $(this)[0].getAttribute("val");

            var userInput = "";
            userInput = confirm("{% trans "Are you sure you want to delete this channel from the make and model object?" %}");
            if (userInput === true) {
                document.location.href = $("#cm-secrect-delete-btn-" + objectId)[0].getAttribute("href");
            }
            e.stopImmediatePropagation();
        });
    </script>
{% endblock body_js %}