{% extends "pop_base.html" %}
{% load static %}
{% load bootstrap4 %}
{% load i18n %}
{% load custom_filters %}

{% block body %}
  <style>
  label {
      font-weight: bold;
  }
  </style>




  <div class="container">
    <h1>
      {{ object }}
    </h1>
    <br><br>

    <form method="post" class="form">
      {% bootstrap_form_errors form %}
      {% csrf_token %}
      {% buttons %}
        <div class="btn-group">
          <button type="submit" class="btn btn-primary">
            {% trans "Update" %}
          </button>
          <a class="btn btn-secondary" onclick="refreshParent(); window.close()" href="#">
            {% trans "Close" %}
          </a>
        </div>
      {% endbuttons %}

      {% for field in form %}
        <div class="{{ field.name }}_div">
          {% if 'editable' in field.field.widget.attrs|lookup:"class" %}

            {% if field.name in help_text_dict %}
              {% bootstrap_label field.label %}
              {% with help_text_dict|lookup:field.name as help_text %}
                <img src="{% static 'img/icons/information.png' %}" style="width: 20px" data-toggle="popover"
                     data-trigger="hover"
                     title="{{ field.label }}"
                     data-content="{{ help_text }}">


                {% bootstrap_field field %}
              {% endwith %}

            {% else %}

              {% bootstrap_label field.label %}
              {% bootstrap_field field %}

            {% endif %}



          {% else %}
            {% if field.name in help_text_dict %}
              {% bootstrap_label field.label %}
              {% with help_text_dict|lookup:field.name as help_text %}
                <img src="{% static 'img/icons/information.png' %}" style="width: 20px" data-toggle="popover"
                     data-trigger="hover"
                     title="{{ field.label }}"
                     data-content="{{ help_text }}">
                {% bootstrap_field field placeholder="" show_label=False %}
              {% endwith %}

            {% else %}
              {% bootstrap_field field placeholder="" %}
            {% endif %}
          {% endif %}
        </div>

      {% endfor %}


      {% buttons %}
        <div class="btn-group">
          <button type="submit" class="btn btn-primary">
            {% trans "Update" %}
          </button>
          <a class="btn btn-secondary" onclick="refreshParent(); window.close()" href="#">
            {% trans "Close" %}
          </a>
        </div>
      {% endbuttons %}
    </form>


  </div>
  {# only do this if we are in the project create view #}




{% endblock %}


{% block body_js %}
  <script type="text/javascript" src="{% static 'widgEditor_1.0.1/scripts/widgEditor.js' %}"></script>

  <script>
  window.resizeTo(width = 1500, height = 800);

  window.onunload = refreshParent;

  function refreshParent() {
    window.opener.location.reload();
  }

  $(document).ready(function () {
    // Stuff to do as soon as the DOM is ready
    $("#id_digestion_level")[0].focus()
  });
  </script>


  <script type="application/javascript">
  function adjustApproved() {
    // if the funding is from a competitive stream, approval is implicit.
    let myVal = $("#id_is_competitive").val();
    if (myVal == "true") {
      $("#id_approved").val("true").prop("disabled", true);
    } else {
      $("#id_approved").prop("disabled", false).val("");
    }
  }

  $("#id_is_competitive").change(function () {
    adjustApproved()
  });

  var $has_new_data = $("#id_has_new_data");
  var $has_travel = $("#id_has_travel");
  var $has_lab_work = $("#id_has_lab_work");

  $(document).ready(function () {
    // Stuff to do as soon as the DOM is ready
    adjustApproved()
    refreshDataSection()
    refreshTravelSection()
    refreshLabSection()

  });

  $("#id_section").change(function () {
    $("form").submit()
  })


  function refreshDataSection() {
    if ($has_new_data.val() === "True") {
      $(".data_collection_div").removeClass("gone")
      $(".data_sharing_div").removeClass("gone")
      $(".data_storage_div").removeClass("gone")
    } else {
      $(".data_collection_div").addClass("gone")
      $(".data_sharing_div").addClass("gone")
      $(".data_storage_div").addClass("gone")
    }
  }

  function refreshTravelSection() {
    if ($has_travel.val() === "True") {
      $(".vehicle_needs_div").removeClass("gone")
      $(".ship_needs_div").removeClass("gone")
    } else {
      $(".vehicle_needs_div").addClass("gone")
      $(".ship_needs_div").addClass("gone")
    }
  }

  function refreshLabSection() {
    if ($has_lab_work.val() === "True") {
      $(".abl_services_required_div").removeClass("gone")
      $(".lab_space_required_div").removeClass("gone")
      $(".chemical_needs_div").removeClass("gone")
    } else {
      $(".abl_services_required_div").addClass("gone")
      $(".lab_space_required_div").addClass("gone")
      $(".chemical_needs_div").addClass("gone")
    }
  }


  $has_new_data.change(function () {
    refreshDataSection()
  })

  $has_travel.change(function () {
    refreshTravelSection()
  })

  $has_lab_work.change(function () {
    refreshLabSection()
  })
  </script>
{% endblock %}