{% load bootstrap4 %}
{% load i18n %}
{% load static %}
{% bootstrap_css %}
{% bootstrap_javascript jquery='full' %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/master.css' %}">

    <script>
        window.resizeTo(width = 700, height = 900);

        window.onunload = refreshParent;

        function refreshParent() {
            window.opener.location.reload();
        }
    </script>
    <div class="indent-med">
        <h1>Overtime Calculator for {{ object }}</h1>
        <form method="post">
            {% csrf_token %}
            {% for field in form %}
                {% bootstrap_field field placeholder="hours" %}
            {% endfor %}
            <input class="btn btn-primary" type="submit">
            <a class="btn btn-secondary" href="{% url 'projects:staff_edit' object.id %}">Cancel </a>
        </form>
        <br>

        <style>
            table {
                font-size: large;
            }
        </style>

        <table class="table table-striped">
            <tr>
                <th>{% trans "Extra Hours to be Worked:" %}</th>
                <td>
                    <span id="extra_hours"></span>
                </td>
            </tr>

            <tr>
                <th>
                    {% trans "Calculated Overtime Hours:" %}
                </th>
                <td>
                    <span id="ot_hours"></span>
                </td>
            </tr>

            <tr>
                <th>
                    {% trans "OT Description:" %}
                </th>
                <td>
                    <span id="ot_description"></span>
                </td>
            </tr>
        </table>


        <h3>
        </h3>
        <h3 class="">

        </h3>
        <div class="" style="vertical-align: top">
        </div>

    </div>

    <script type="application/javascript">
        // declare vars
        var totalHoursWorked;
        var totalOTHours;
        var OTDescription;
        var OTDescriptionHTML;

        var weekdayHoursWorked;
        var satHoursWorked;
        var sunHoursWorked;
        var statHoursWorked;

        var weekdayOT;
        var satOT;
        var sunOT;
        var statOT;


        $(document).ready(function () {
            // Stuff to do as soon as the DOM is ready
            updateVars();
            $("#id_weekdays")[0].focus()

        });

        $("form").keyup(function functionName() {
            updateVars()
        });

        function updateVars() {
            weekdayHoursWorked = Number($("#id_weekdays").val());
            satHoursWorked = Number($("#id_saturdays").val());
            sunHoursWorked = Number($("#id_sundays").val());
            statHoursWorked = Number($("#id_stat_holidays").val());

            weekdayOT = weekdayHoursWorked * 1.5;
            satOT = satHoursWorked * 1.5;
            sunOT = sunHoursWorked * 2;
            statOT = statHoursWorked * 2;

            totalHoursWorked = weekdayHoursWorked + satHoursWorked + sunHoursWorked + statHoursWorked;
            totalOTHours = weekdayOT + satOT + sunOT + statOT;
            OTDescriptionHTML = "Weekday hours: " + weekdayHoursWorked + " x 1.5 = " + weekdayOT + " hours" +
                "<br>" + "Saturday hours: " + satHoursWorked + " x 1.5 = " + satOT + " hours" +
                "<br>" + "Sunday hours: " + sunHoursWorked + " x 2 = " + sunOT + " hours" +
                "<br>" + "Statutory holiday hours: " + statHoursWorked + " x 2 = " + statOT + " hours"

            OTDescription = OTDescriptionHTML.replace(/<br>/gi, "\n")
            console.log(OTDescription)
            $("#extra_hours").text(totalHoursWorked);
            $("#ot_hours").text(totalOTHours);
            $("#ot_description").html(OTDescriptionHTML);
            $("#id_overtime_hours").val(totalOTHours)
            $("#id_overtime_description").val(OTDescription)

        }


    </script>
{% endblock content %}
