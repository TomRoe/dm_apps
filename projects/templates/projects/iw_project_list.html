{% extends "projects/projects_base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}
{% load i18n %}
{% load verbose_names %}

{% block content %}
    {% get_current_language as LANG %}

    <style>
        table, td {
            font-size: 12px;
        }

        .abase {
            background-color: {{abase}};
        }

        .bbase {
            background-color: {{bbase}};
        }

        .cbase {
            background-color: {{cbase}};
        }

        .total {
            font-weight: bold;
        }

    </style>

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'projects:index' %}">
                    {% trans "Home" %}
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'projects:iw_group_list' section.division.branch.region.id fy.id %}">
                    {% trans "Functional Group Summary" %}
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                Projects from {{ section }} Section
                {% if functional_group %}
                    under {{ functional_group }}
                {% endif %}
            </li>
        </ol>
    </nav>

    <div class="container-fluid">
        {{ get_current_language }}
        <div class="">
            <h1>
                Projects from {{ section }} Section
                {% if functional_group %}
                    under {{ functional_group }}
                {% endif %}
            </h1>
            <h3>
                {% if section.division.branch.region.id == 1 %}
                    (Submitted and approved by {{ section.head }})
                {% else %}
                    (Submitted by {{ section.head }})
                {% endif %}
            </h3>
        </div>

        <br>
        <div class="">
            <table class="table table-hover table-bordered table-sm sortable">
                <tr>
                    {% for field in field_list %}
                        <th rowspan="">
                            {% get_verbose_label project_list.first field %}
                        </th>
                    {% endfor %}
                </tr>

                <tbody>

                {% for p in project_list %}
                    <tr pop href="{% url 'projects:project_overview' p.id 1 %}">
                        {% for field in field_list %}
                            <td rowspan="">
                                {% get_field_value p field %}
                            </td>
                        {% endfor %}
                        <td style="width: 10%;">
                            <a href="#" pop-href="{% url 'projects:project_notes' p.id %}"
                               class="stop-pop btn btn-sm btn-primary">
                                {% trans "Edit Notes" %}
                            </a>
                        </td>
                    </tr>

                {% endfor %}

                </tbody>
            </table>
        </div>
        <br>
        <div class="">
            <div class="mb-3">
                <h2>{% trans "Financial Summary" %}</h2>
            </div>

            <table class="table table-bordered table-sm" style="width: auto">
                <tr>
                    <th style="width: 150px;">
                        {% trans "Type" %}
                    </th>
                    <th style="width: 150px;">
                        {% trans "Funding source" %}
                    </th>
                    <th style="width: 150px;">
                        {% trans "Salary (excluding FTE)" %}
                    </th>
                    <th style="width: 150px;">
                        {% trans "O & M" %}
                    </th>
                    <th style="width: 150px;">
                        {% trans "Captial" %}
                    </th>
                    <th style="width: 150px;">
                        {% trans "Total" %}
                    </th>
                </tr>
                <tbody>
                {% with "---" as na %}
                    {% for fs in financials_dict %}
                        {% with financials_dict|lookup:fs  as fs_dict %}
                            <tr style="background-color: {{ fs.funding_source_type.color }}">
                                <td>{{ fs.funding_source_type|nz:_("Total") }}</td>
                                <td>{{ fs.tname|nz:"---" }}</td>
                                <td>{{ fs_dict|lookup:"salary"|kmark:"2,False" }}</td>
                                <td>{{ fs_dict|lookup:"om"|kmark:"2,False" }}</td>
                                <td>{{ fs_dict|lookup:"capital"|kmark:"2,False" }}</td>
                                <td>{{ fs_dict|lookup:"total"|kmark:"2,False" }}</td>
                            </tr>
                        {% endwith %}
                    {% endfor %}
                {% endwith %}

                </tbody>
            </table>

        </div>
    </div>

{% endblock content %}
