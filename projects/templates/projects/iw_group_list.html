{% extends "projects/projects_base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}
{% load i18n %}

{% block content %}
    {% get_current_language as LANG %}

    <style>
        table, td {
            font-size: 14px;
        }

        .division {
            background-color: #2826ff;
            color: white;
            font-size: 20px;
            font-family: 'Open Sans', sans-serif;
        }

        .section {
            background-color: #d5d1ff;
            color: black;
            font-size: 16px;
            font-family: 'Open Sans', sans-serif;
        }

        .pressures {
            background-color: #ffbc76;
            font-style: italic;
        }

        .general-notes {
            background-color: #c2ffc8;
            font-style: italic;
        }
    </style>

    {% if view.kwargs.type == "theme" %}
        {% trans "Theme" as big_unit %}
        {% trans "Program" as small_unit %}
    {% else %}
        {% trans "Division" as big_unit %}
        {% trans "Section" as small_unit %}
    {% endif %}

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'projects:index' %}">
                    {% trans "Home" %}
                </a>
            </li>

            <li class="breadcrumb-item active" aria-current="page">
                {% trans "Functional Group Summary" %} ({{ big_unit }}/{{ small_unit }})
            </li>
        </ol>
    </nav>



    <div class="container-fluid">
        {{ get_current_language }}
        <div class="row">
            <div class="col">
                <h1>


                    {{ fy }} {% trans "Summary of Functional Groups by " %} {{ big_unit }}/{{ small_unit }} ({{ region }})
                </h1>
                <h3>
                    {% if region.id == 1 %}
                        {% trans "Projects submitted and approved by section heads" %}
                    {% else %}
                        {% trans "Projects submitted by section heads" %}
                    {% endif %}
                </h3>
            </div>
            {#            <div class="col">#}
            {#                <h4>{% trans "Meeting Resources" %}:</h4>#}
            {#                {% with "None" as n %}#}
            {##}
            {#                    <ul>#}
            {#                        <li>#}
            {#                            <a href="{% url 'projects:pdf_fte_summary' fy.id 1 n n %}" target="_blank">Weeks worked by employees</a>#}
            {#                        </li>#}
            {#                        <li>#}
            {#                            <a href="{% url 'projects:pdf_ot' fy.id 1 n n %}" target="_blank">Total OT hours requested</a>#}
            {#                        </li>#}
            {#                        <li>#}
            {#                            <a href="{% url 'projects:pdf_costs' fy.id 1 n n %}" target="_blank">Financial summary</a>#}
            {#                        </li>#}
            {#                        <li>#}
            {#                            <a href="{% url 'projects:pdf_collab' fy.id 1 n n %}" target="_blank">Collaborators</a>#}
            {#                        </li>#}
            {#                        <li>#}
            {#                            <a href="{% url 'projects:pdf_agreements' fy.id 1 n n %}" target="_blank">Collaborative agreements</a>#}
            {#                        </li>#}
            {#                        <li>#}
            {#                            <a href="{% url 'projects:doug_report' fy.id 1 n n %}">#}
            {#                                Summary spreadsheet#}
            {#                            </a>#}
            {#                            &nbsp; <img src="{% static 'img/icons/excel.svg' %}" width="20px">#}
            {#                        </li>#}
            {##}
            {#                    </ul>#}
            {#                {% endwith %}#}
            {##}
            {#            </div>#}
        </div>

        <br>
        <div class="">
            <table class="table table-hover table-sm">
                <thead>
                <th>{% trans "Functional Group" %}</th>
                <th class="center-col">{% trans "Number of projects" %}</th>
                <th>{% trans "Project leads" %}</th>
                </thead>
                <tbody>

                {% for d in my_dict %}
                    <tr>
                        <td colspan="4" class="division">
                            {{ big_unit|upper }}: {{ d }}
                        </td>
                    </tr>
                    {% for s in my_dict|lookup:d %}
                        <tr>
                            <td colspan="4"></td>
                        </tr>

                        {% url 'projects:iw_project_list' fy.id region.id s.id view.kwargs.type as url_a %}

                        <tr href="{{ url_a }}" style="border: 20px" class="section">
                            <td colspan="6" class="section">
                                {% with my_dict|lookup:d|lookup:s|lookup:"projects" as projects %}
                                    {{ small_unit|upper }}: {{ s }} ({{ projects.count }} project{{ projects.count|pluralize }})
                                {% endwith %}
                            </td>
                        </tr>
                        {% for group in my_dict|lookup:d|lookup:s|lookup:"groups" %}

                            {% if group %}
                                {% url 'projects:iw_project_list' fy.id region.id s.id group.id view.kwargs.type as url_b %}
                            {% else %}
                                {% url 'projects:iw_project_list' fy.id region.id s.id view.kwargs.type as url_b %}
                            {% endif %}


                            <tr href="{{ url_b }}">
                                {% trans "<em class='red-font'>No functional group assigned</em>" as no_group %}
                                <td colspan="1" class="program">{{ group|nz:no_group }}</td>
                                <td colspan="1"
                                    class="center-col">{{ my_dict|lookup:d|lookup:s|lookup:"groups"|lookup:group|lookup:"project_count" }}</td>
                                <td colspan="1"
                                    class="program">{{ my_dict|lookup:d|lookup:s|lookup:"groups"|lookup:group|lookup:"leads" }}</td>
                            </tr>
                        {% endfor %}


                    {% endfor %}
                    <tr>
                        <td colspan="4"></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </div>

{% endblock content %}
