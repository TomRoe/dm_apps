{% extends 'base.html' %}

{% load static %}
{% load i18n %}
{% load verbose_names %}

{% block body %}

    <div class="container-fluid">
        <div class="mb-5 row">
            <div class="col-2">
                <img src="{% static 'shiny/img/rproj.jfif' %}" alt="" width="100px">
            </div>
            <div class="">
                <h1>{% trans "Shiny Apps Hosted on DM Apps" %}</h1>
            </div>
        </div>


        {% if object_list.count %}

            <div class="row">
                <div class="col">
                    {% trans "(click on a header to sort table)" %}
                </div>
                <div class="col" style="text-align: center">
                    <em>{% trans 'displaying' %} {% trans "all" %} {{ object_list.count }} {% trans "records" %}</em>
                </div>
                <div class="col" style="text-align: right; padding-bottom: 10px">
                    <a href="{% url 'shiny:create' %}" class="btn btn-sm btn-success">{% trans 'Add an app' %}</a>
                </div>
            </div>
            <table class="table table-stripped sortable">
                <thead>
                {% for field in field_list %}
                    <th style="{% if "github" in field %}width:150px{% elif "descr" in field %}width:500px{% elif "last" in field %}width:150px{% endif %}">
                        {% get_verbose_label object_list.first field %}
                    </th>
                {% endfor %}
                <th></th>
                </thead>
                <tbody>
                {% for object in object_list %}
                    <tr>
                        {% for field in field_list %}
                            <td>
                                {% if "thumbnail" in field %}
                                    {% if object.thumbnail %}
                                        <img src="{{ object.thumbnail.url }}" alt="" width="150">
                                    {% else %}
                                        <img src="{% static 'shiny/img/rproj.jfif' %}" alt="" width="150">
                                    {% endif %}
                                {% elif "github" in field %}
                                    {% if object.github_url %}
                                        <a href="{{ object.github_url|safe }}" target="_blank">
                                            <img src="{% static 'shiny/img/GitHub-Mark-32px.png' %}" alt="">
                                        </a>
                                    {% else %}
                                        :(
                                    {% endif %}
                                {% elif "owner" in field %}
                                    <a href="mailto:{{ object.owner.email }}?subject=your awesome shiny app... {{ object.ttitle }}">
                                        {% get_field_value object field %}
                                    </a>
                                {% else %}
                                    {% get_field_value object field %}
                                {% endif %}
                            </td>
                        {% endfor %}
                        <td style="width: 150px">
                            <a href="{{ object.url|safe }}" class="btn btn-sm btn-primary mb-2 py-0" target="_blank">{% trans "Open" %}</a>
                            {% if user == object.owner or user.is_superuser %}
                                <a href="{% url 'shiny:update' object.id %}"
                                   class="btn btn-sm btn-warning py-0">{% trans "Edit record" %}</a>
                            {% endif %}

                        </td>
                    </tr>
                {% endfor %}

                </tbody>
            </table>

        {% else %}
            <em>No apps to display</em>
            <br>
            <br>
            <a href="{% url 'shiny:create' %}" class="btn btn-sm btn-success">{% trans 'Add the first app' %}</a>

        {% endif %}
    </div>

{% endblock %}