{% extends 'pop_base.html' %}
{% load bootstrap4 %}
{% load i18n %}
{% load custom_tags %}
{% load custom_filters %}
{% block body %}

    {% crash_if_none "title" title %}

    <div class="container">
        <div class="mb-3">
            <h1>
                {{ h1 }}
            </h1>
        </div>

        <form method="post" class="form">
            {% csrf_token %}

            <div id="fields">
                {% for field in form %}
                    {% bootstrap_field field placeholder="" show_label=False %}
                {% endfor %}
                <div class="btn-group">
                    <button type="submit" class="btn btn-success" onclick="refreshParent()">
                        {% trans "Save" %}
                    </button>
                    <a class="btn btn-secondary" onclick="refreshParent(); window.close()" href="#">
                        {% trans "Close" %}
                    </a>
                </div>
            </div>

        </form>
    </div>


{% endblock %}

{% block body_js %}
    {# A script to refresh the parent window; to be called in when the buttons are pushed #}
    <script>

        window.resizeTo(width = {{width|nz:900}}, height = {{height|nz:500}});

        window.onunload = refreshParent;

        function refreshParent() {
            window.opener.location.reload();
        }

        $(document).ready(function () {
            // Stuff to do as soon as the DOM is ready
            $("input").first().select();
        });

    </script>
{% endblock %}