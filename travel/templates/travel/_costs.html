{% load i18n %}
{% load static %}
{% load verbose_names %}
{% load custom_filters %}

{% if not triprequest.is_group_request %}
  <span id="costs"></span>


  <div class="card mb-2">
    <h3 class="card-header bg-outline-dark">
      {% trans "Costs" %}
      <div class="neighbours">
        {% with help_text_dict|lookup:"costs_header" as help_text %}
          <img src="{% static 'img/icons/information.png' %}" style="width: 30px" data-toggle="popover"
               data-trigger="hover"
               title="{% trans "Trip Request Costs" %}"
               data-content="{{ help_text }}">
        {% endwith %}
      </div>

      {% if not report_mode %}
        <div class="btn-group float-right">
          <a class="btn btn-sm btn-outline-primary" href="#" pop-href="{% url 'travel:tr_cost_new' triprequest.id %}">
            {% trans "Add new cost" %}
          </a>
          <a class="btn btn-sm btn-outline-success" href="{% url 'travel:tr_cost_populate' triprequest.id %}">
            {% trans "Add all costs" %}
          </a>

          <a class="btn btn-sm btn-outline-dark" href="{% url 'travel:tr_cost_clear' triprequest.id %}">
            {% trans "Clear empty lines" %}
          </a>
        </div>
      {% endif %}
    </h3>
    <div class="card-body">
      <div class="card-text">
        <p>
          {% blocktrans %}
            Per diem rates for breakfast, lunch, supper and incidentals should follow the
            <a href="https://www.njc-cnm.gc.ca/">National Joint Council</a> Travel Directive.
            For travel within Canada and
            USA, please refer to <a href="https://www.njc-cnm.gc.ca/directive/d10/v238/s659/en">Appendix C</a>
            and for all other travel please refer to
            <a href="https://www.njc-cnm.gc.ca/directive/app_d.php?lang=en">Appendix D</a>.
            <span class="red-font">Please note that all expenses for this request should be entered in Canadian dollars.</span>
          {% endblocktrans %}
        </p>

        {% if triprequest.trip_request_costs.count == 0 %}
          <em>
            {% trans "There are no costs associated with this request" %}...
          </em>
          <br>
        {% else %}
          <div class="row justify-content-center" id="id_cost">
            <div class="col-5 justify-content-center">
              <div v-if="loading_costs" class="loading mb-3 mt-3 text-center mt-5">
                <div class="spinner-border mb-3" style="width: 10rem; height: 10rem;" role="status">
                  <span class="sr-only"></span>
                </div>
              </div>
              <table
                v-else
                class="table {% if not report_mode %} table-hover {% endif %} table-sm"
              >
                <tr>
                  {% for field in cost_field_list %}
                    <th class="{% if not field == "cost" %}center-col{% endif %}">
                      {% get_verbose_label triprequest.trip_request_costs.first field %}
                    </th>
                  {% endfor %}
                </tr>
                <tbody>


                <tr
                  v-for="c in costs"
                  {% if not report_mode %}
                    @click="openCostPopout(c.id)"
                  {% endif %}
                >
                  {# cost #}
                  <td class="">
                    ${c.cost_display }
                  </td>

                  {# daily_rate #}
                  <td class="center-col">
                    ${c.rate_cad |floatformat |nz|zero2NullMark}
                  </td>

                  {# days #}
                  <td class="center-col">
                    ${c.number_of_days|nz|zero2NullMark }
                  </td>

                  {# Amount CAD #}
                  <td class="text-center">
                    ${c.amount_cad |floatformat |zero2NullMark }
                  </td>

                  {% if not report_mode %}
                    <td>
{#                      <button @click="openCostPopout(c.id)">#}
                        <span class="mdi mdi-pencil"></span>
{#                      </button>#}
                    </td>
                  {% endif %}
                </tr>
                <tr>
                  <td class=""><strong>TOTAL</strong></td>
                  <td class="center-col">---</td>
                  <td class="center-col">---</td>
                  <td class="center-col"><strong>${ totalCosts |floatformat |nz|zero2NullMark }</strong></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

        {% endif %}

      </div>


    </div>
  </div>
  <br>
  <br>
{% endif %}



