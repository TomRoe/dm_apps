{% extends "travel/form.html" %}
{% load static %}
{% load bootstrap4 %}
{% load verbose_names %}
{% load custom_filters %}
{% load custom_tags %}
{% load i18n %}
{% load humanize %}


{% block pre_form_div %}
  <hr>
  <div id="app" v-cloak>
    {% include "travel/common/_trip_detail.html" %}
    {% include "travel/common/_travellers.html" %}
    {% include "travel/common/_reviewers.html" %}

    <div v-if="trip.id && !trip.trip_review_ready.can_proceed">
      <div class="alert alert-warning mt-5" role="alert" style="width: 50%">
        <p class="alert-heading">
          <span class="mdi mdi-alarm-light h3 mr-3"></span>
          <span class="h4">{% trans "This review cannot be submitted because..." %}</span>
        </p>
        <p class="h6"> ${trip.trip_review_ready.reason}</p>
      </div>
    </div>

  </div>
{% endblock %}



{% block form_fields %}
  <div class="mt-5">
    {% for field in form %}
      {% if field.name == 'comments' %}
        <h3>{% trans "Please provide your approval comments here (required)" %}</h3>
        {% bootstrap_field field show_label=False %}

      {% else %}
        {{ field }}
      {% endif %}

    {% endfor %}


  </div>
{% endblock %}

{% block form_buttons %}

  <div class="float-right">
    <a class="btn btn-outline-dark" href="{% url 'travel:trip_detail' object.trip.id %}" target="_blank">
      {% trans "Go to Trip Page" %}
    </a>
  </div>

  <div class="mt-3 mb-3">
    <span data-toggle="tooltip" title="{{ object.trip.trip_review_ready.reason }}">
    <input type="submit" class="btn btn-danger {% if not object.trip.trip_review_ready.can_proceed %}disabled{% endif %}"
           {% if not object.trip.trip_review_ready.can_proceed %}disabled{% endif %} value="{{ submit_text }}">
    </span>

    {# reinitiate #}
    {% if object.trip.current_reviewer != object.trip.reviewers.first %}
      <button type="button" class="btn btn-warning" id="reset">
        {% trans "Modifications Required" %}
      </button>
    {% endif %}

    <button type="button" class="btn btn-primary" id="save">
      {% trans "Save comments" %}
    </button>

    <a class="btn btn-secondary" href="{{ back_url }}">
      {% trans "Cancel" %}
    </a>
  </div>
{% endblock %}


{% block body_js %}
  {{ block.super }}
  <script type="application/javascript">
  let isReview = true;
  </script>
  {% include "travel/common/_trip_script.html" %}


  <script type="application/javascript">
  $("#save").click(function () {
    $("#id_stay_on_page").val(1);
    $("form").submit();
  });

  $("#reset").click(function () {
    var input = confirm("{% trans 'By proceeding, you will be returning this review to the first reviewer in the queue: '%}  {{ object.trip.reviewers.first.user }} \n\n {%trans 'Are you certain you wish to proceed?'%}");
    $("#id_reset").val(1);
    $("form").submit();
  });

  </script>
{% endblock %}