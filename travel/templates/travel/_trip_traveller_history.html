{% load i18n %}
{% load custom_filters %}

<table class="plainjane" style="width: 75%;">
    <tr class="plainjane">
        <th rowspan="2" class="plainjane">{% trans "Name" %}</th>
        <th colspan="2"
            class="plainjane center-col">{% trans "Trips requiring the approval of ADM" %}</th>
    </tr>
    <tr class="plainjane">
        <th class="plainjane center-col">{{ trip.fiscal_year }}</th>
        <th class="plainjane center-col">Total</th>
    </tr>
    {% for traveller in trip.total_traveller_list %}
        {% with trip.get_summary_dict|lookup:traveller as d %}
            <tr class="plainjane">
                <td class="plainjane">
                    {{ traveller }}
                    {% if traveller in trip.bta_traveller_list %}{% trans "(BTA)" %}{% endif %}
                </td>
                <td class="plainjane center-col">
                    {% if traveller.id %}
                        {{ d.fy_list|length }}
                        {% if d.fy_list|length %}
                            &nbsp;
                            {% with d.fy_list as my_list %}
                                <button class="badge" data-toggle="popover"
                                        title="{{ traveller.first_name }}'s Total Requests for {{ trip.fiscal_year }}"
                                        data-content="{% include "travel/_user_trip_request_list.html" %}">
                                    {% trans "show" %}
                                </button>
                            {% endwith %}
                        {% endif %}
                    {% else %}
                        <em>
                            ----
                        </em>
                    {% endif %}
                </td>

                <td class="plainjane center-col">
                    {% if traveller.id %}
                        {{ d.total_list|length }}
                        {% if d.total_list|length %}
                            &nbsp;
                            {% with d.total_list as my_list %}
                                <button class="badge" data-toggle="popover"
                                        title="{{ user.first_name }}'s Total Requests"
                                        data-content="{% include "travel/_user_trip_request_list.html" %}">
                                    {% trans "show" %}
                                </button>
                            {% endwith %}
                        {% endif %}
                    {% else %}
                        <em>
                            {{ d.total_list }}
                        </em>
                    {% endif %}
                </td>
            </tr>
        {% endwith %}
    {% endfor %}
    <tr>
        <th colspan="3">{% trans "TOTAL NUMBER OF TRAVELLERS" %}
            = {{ trip.total_traveller_list|length }}</th>
    </tr>


</table>
