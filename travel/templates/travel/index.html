{% extends "travel/base.html" %}
{% load i18n %}
{% load static %}
{% load custom_filters %}
{% load custom_tags %}
{% load bootstrap4 %}

{% block alerts %}
{% endblock %}
{% block content %}
  <style>


  .jumbotron {
      background-color: rgba(255, 255, 255, 1);
  {#border: black solid 1px;#} margin-left: 25px;
      margin-right: 25px;
      border-radius: 25px;
  }


  .btn-primary {
      background-color: #79aec8;
      border: grey;
  }

  .container-fluid, .container {
      border-radius: 25px;
      margin-top: 15px;
      padding: 15px;
      background-color: transparent;
      font-size: small;

  }

  .btn-special {
      border: 1px grey solid;
      border-radius: 25px;
  }

  .subtitle, .subtitle-success {
      font-size: 16px;
      font-weight: bold;
  }

  .subtitle-success {
      color: green;
  }

  .nav-tabs {
      font-size: 16px;
  }


  .text-black {
      font-size: 16px;
  }
  </style>

  <div class="container">

  <div class="jumbotron py-3 mx-0">
    <div class="mb-5">
      <h1 class="three-em center-col">
        {% trans "EOS Conference and Travel Management System" %}
      </h1>
      <h3 class="text-center text-muted">
        {% trans '"Pre-approval for travel"' %}
      </h3>
    </div>

    {# Warnings #}
    <div class="mb-3">
      {% autoescape off %}
        {% bootstrap_messages size='small' %}
      {% endautoescape %}
    </div>


    {% url 'travel:request_new' "my" as request_new_url %}
    {% url 'travel:request_list' user|slugify as request_list_url %}

    {% url 'travel:request_review_list' "awaiting" as active_tr_reviews_list_url %}
    {% url 'travel:request_review_list' as all_tr_reviews_list_url %}

    {% url 'travel:trip_review_list' "awaiting" as active_trip_reviews_list_url %}
    {% url 'travel:trip_review_list'  as all_trip_reviews_list_url %}

    <div class="row mb-4 justify-content-center">
      <div class="container mt-3">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#overview">{% trans "Overview" %}</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#traveller">{% trans "Traveller" %}</a>
          </li>

          {% if reviews_waiting %}
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#reviewer">
                {% trans "Reviewer" %}
                {% if reviews_waiting %} (<span class="red-font blink-me">{{ reviews_waiting }}</span>) {% endif %}
              </a>
            </li>
          {% endif %}

          {% if is_admin %}
            {% for region in tab_dict %}
              {% with tab_dict|lookup:region as dict %}
                {% if dict.things_to_deal_with or "ADM" in region or "SMA" in region %}

                  <li class="nav-item">
                    <a class="nav-link" data-toggle="tab"
                       href="#region_{{ region|slugify }}">
                      {{ region }}
                      {% if dict.things_to_deal_with %}
                        (<span class="red-font blink-me">{{ dict.things_to_deal_with }}</span>)
                      {% endif %}
                    </a>
                  </li>
                {% endif %}
              {% endwith %}
            {% endfor %}
          {% endif %}

          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#help">{% trans "Support" %}</a>
          </li>

        </ul>
        {% echo "22em" as width1 %}
        {% echo "24em" as width2 %}
        {% echo "26em" as width3 %}
        <!-- Tab panes -->
        <div class="tab-content">
        {# Help Pane #}
          <div id="help" class="container tab-pane fade"><br>
            <div class="mt-2">
              {% include "travel/_help.html" %}
            </div>
          </div>


          {# Overview Pane #}
          <div id="overview" class="container tab-pane fade active show"><br>
            <div class="mt-2">
              {% include "travel/_process_timeline.html" %}
            </div>
          </div>


          {# Traveller Pane #}
          <div id="traveller" class="container tab-pane fade"><br>

            <div class="btns mb-3 center-col">

              <a href="{{ request_new_url }}" class="btn btn-lg btn-outline-primary mx-3">
                {% trans "Create a New Request" %}
              </a>

              {% if user_trip_requests > 0 %}
                <a href="{{ request_list_url }}"
                   class="btn btn-lg btn-outline-primary  mx-3">
                  {% trans "View Your Requests" %}
                  ({{ user_trip_requests }})
                </a>
              {% endif %}

              <a href="{% url 'travel:trip_list' "upcoming" %}"
                 class="btn btn-lg btn-outline-primary mx-3">
                {% trans "Browse Upcoming Trips" %}
              </a>

            </div>

            {% if requests_awaiting_changes %}
              <div class="row justify-content-center">
                <div class="col-7 alert alert-danger center-col" role="alert">
                  <h5 class="py-1 blink-me">
                    {% trans "There are trip requests requiring your attention!" %}
                  </h5>
                </div>
              </div>
            {% endif %}


          </div>

          {# Reviewer Pane #}

          <div id="reviewer" class="container tab-pane fade"><br>


            <div class="btns mb-3 center-col">

              <h2 class="">{% trans "Your Reviews" %}</h2>
              <p class="card-text">{% trans "View and manage trips and/or trip requests for which you are a reviewer" %}</p>
              {% if is_trip_reviewer %}
                {% if trip_reviews_waiting %}

                  <a href="{{ active_trip_reviews_list_url }}"
                     class="btn btn-lg btn-outline-primary mx-3 {{ disabled_text }}">
                    {% trans "Trips Awaiting Review" %}
                    (<span class="red-font blink-me">{{ trip_reviews_waiting }}</span>)
                  </a>
                {% endif %}
              {% endif %}

              {% if is_tr_reviewer %}
                {% if tr_reviews_waiting %}
                  <a href="{{ active_tr_reviews_list_url }}"
                     class="btn btn-lg btn-outline-primary mx-3 {{ disabled_text }}">
                    {% trans "Requests Awaiting Review" %}
                    (<span class="red-font blink-me">{{ tr_reviews_waiting }}</span>)
                  </a>
                {% endif %}
              {% endif %}
            </div>
          </div>

          {% for region in tab_dict %}
            {% with tab_dict|lookup:region as dict %}
              <div id="region_{{ region|slugify }}" class="container tab-pane fade"><br>


                <div class="btns mb-3 center-col">
                  <h2 class="card-title">
                    {% if region.id %}
                      {% blocktrans with region as r %}
                        {{ r }} Region - Admin
                      {% endblocktrans %}
                    {% else %}
                      {{ region }} - Admin
                    {% endif %}
                  </h2>
                  <p class="card-text">{% trans "Perform tasks reserved for travel app administrators" %}</p>

                  {% if not "ADM" in region and not "SMA" in region %}
                    {% if dict.adm_number_waiting %}
                      <a href="{{ dict.adm_approval_list_url }}" class="btn btn-lg btn-outline-primary mx-3">
                        {% trans "Requests Awaiting ADM" %}
                        (<span class="red-font blink-me">{{ dict.adm_number_waiting }}</span>)
                      </a>
                    {% endif %}
                  {% endif %}

                  {# RDG stuff #}
                  {% if not "ADM" in region and not "SMA" in region %}
                    {% if dict.rdg_number_waiting %}
                      <a href="{{ dict.rdg_approval_list_url }}" class="btn btn-lg btn-outline-primary mx-3">
                        {% trans "Requests Awaiting RDG" %}
                        (<span class="red-font blink-me">{{ dict.rdg_number_waiting }}</span>)
                      </a>
                    {% endif %}
                  {% endif %}


                  {# Verification #}
                  {% if dict.unverified_trips %}
                    <a href="{{ dict.trip_verification_list_url }}" class="btn btn-lg btn-outline-primary mx-3">
                      {% trans "Trip Verifications" %}
                      (<span class="red-font blink-me">{{ dict.unverified_trips }}</span>)
                    </a>
                  {% endif %}

                  {% if "ADM" in region or "SMA" in region %}
                    {# ADM hit list stuff #}
                    {% if dict.adm_trips_ready %}

                      <a href="{% url 'travel:trip_list' "adm-hit-list" %}"
                         class="btn btn-lg btn-outline-primary mx-3">
                        {% trans "The ADMO Net" %}
                        (<span class="red-font blink-me">{{ dict.adm_trips_ready }}</span>)
                      </a>

                    {% endif %}

                  {% endif %}

                </div>
              </div>

            {% endwith %}
          {% endfor %}

        </div>

      </div>
    </div>


  </div>
  {#    <div class="jumbotron py-3 mx-0" style="background-color:white;">#}
  {##}
  {#       #}
  {##}
  {#    </div>#}



  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>

{% endblock content %}


{% block body_js %}
    {{ block.super }}

  <script type="application/javascript">
  {#        {% if reviews_waiting %}#}
  {#            $('#reviewer').tab('show');#}
  {#        {% else %}#}
  {#            $('#traveller').tab('show');#}
  {#        {% endif %}#}


  </script>
{% endblock %}