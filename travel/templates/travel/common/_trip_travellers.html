{% load static %}
{% load i18n %}
{% load custom_filters %}
{% load travel_filters %}
{% load travel_tags %}
{% load verbose_names %}

<div v-if="canModify && trip.travellers.length" class="card mb-2">
  <h3 class="card-header bg-outline-dark">
    <div class="float-right">
      <button @click="expandTravellers" data-toggle="tooltip" title="{% trans "Expand all" %}"><span class="mdi mdi-arrow-collapse-down blue"></span></button>
      <button @click="collapseTravellers" data-toggle="tooltip" title="{% trans "Collapse all" %}"><span class="mdi mdi-arrow-collapse-up blue"></span></button>
    </div>
    {% trans "Travellers Associated with this Trip" %}
    <span @mouseover="enablePopovers" class="mdi mdi-help-circle-outline" data-toggle="popover"
          data-trigger="hover" title="{% trans "Travellers" %}"
          :data-content="helpText.travellers_header"></span>
  </h3>
  <div class="card-body">
    <div class="card-text">
      <div v-if="loading_trip" class="loading mb-3 mt-3 text-center mt-5">
        <div class="spinner-border mb-3" style="width: 10rem; height: 10rem;" role="status">
          <span class="sr-only"></span>
        </div>
      </div>
      <div v-else>
        <div v-if="!trip.travellers.length">
          <em>{% trans "There are no travellers associated with this trip." %}</em>
        </div>
        <div v-else>
          <div v-if="trip && trip.travellers.length">
            <div>
              <div class="row">
                <div v-for="t in trip.travellers" class="col" :key="t.id">
                  <div class="card traveller-card">
                    <div class="card-body">
                      <div class="float-right">
                        <button @click="toggleShowMe(t)"
                                data-toggle="tooltip" title="{% trans "collapse" %}">
                          <span v-if="t.show_me" class="mdi mdi mdi-arrow-collapse-up h4 blue"></span>
                          <span v-else class="mdi mdi mdi-arrow-collapse-down h4 blue"></span>
                        </button>
                      </div>
                      <h4 class="card-title">
                        ${t.smart_name} <span v-if="t.is_research_scientist">(RES)</span>
                      </h4>
                      <div v-if="t.show_me" class="card-text">
                        <hr>
                        <h4>{% trans "Request Level" %}</h4>

                        <p>
                          <b>{% trans "Associated trip request" %}</b>
                          <a :href="`/travel-plans/requests/${t.request_obj.id}/view/`" target="_blank">${t.request_obj.display}</a>
                        </p>
                        <p>
                          <b>${requestLabels.status}</b>
                          <span><span :class="t.request_obj.status_class + ' px-1 py-1'">${t.request_obj.status_display}</span></span>
                        </p>
                        <p>
                          <b>{% trans "DFO region" %}</b>
                          <span>${t.request_obj.region}</span>
                        </p>
                        <p>
                          <b>{% trans "Objective of trip" %}</b>
                          <span>${t.request_obj.objective_of_event | nz}</span>
                        </p>
                        <p>
                          <b>{% trans "Benefits to DFO" %}</b>
                          <span>${t.request_obj.benefit_to_dfo | nz}</span>
                        </p>
                        <p v-if="t.request_obj.late_justification">
                          <b>${requestLabels.late_justification}</b>
                          <span>${t.request_obj.late_justification}</span>
                        </p>

                        <hr>
                        <h4>{% trans "Traveller Level" %}</h4>
                        <div class="mb-3">
                          <span v-html="t.traveller_info"></span>
                        </div>
                        <p><b>{% trans "Public servant:" %}</b><span class="ml-1">${t.is_public_servant|yesNo}</span></p>
                        <p><b>{% trans "Research scientist:" %}</b><span class="ml-1">${t.is_research_scientist|yesNo}</span></p>
                        <p><b>{% trans "Travel dates:" %}</b><span class="ml-1" v-html="t.dates"></span></p>
                        <p><b>{% trans "Departure location:" %}</b><span class="ml-1" v-html="t.departure_location"></span></p>
                        <p><b>${travellerLabels.role}</b><span class="ml-1" v-html="t.role">${t.role|nz}</span></p>
                        <p><b>${travellerLabels.role_of_participant}</b><span class="ml-1">${t.role_of_participant|nz}</span></p>
                        <p><b>{% trans "Part of learning plan:" %}</b><span class="ml-1">${t.learning_plan|yesNo}</span></p>
                        <p><b>{% trans "Non-DFO costs:" %}</b><span class="ml-1" v-html="t.non_dfo_costs_html"></span></p>

                        <div>
                          <b>{% trans "Cost Breakdown:" %}</b>
                          <span class="ml-1" v-html="t.cost_breakdown_html"></span>
                        </div>

                        <div class="float-right">
                          <button v-if="canModify" @click="deleteTraveller(t)" class="btn btn-sm btn-danger">{% trans "Remove" %}</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div v-else>
            <em>{% trans "There are no travellers associated with this trip" %}</em>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
