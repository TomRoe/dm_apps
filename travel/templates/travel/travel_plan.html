{% load verbose_names %}
{% load bootstrap4 %}
{% load humanize %}
{% load custom_filters %}
{% load i18n %}
{% load static %}

{% block extra_style %}
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
{% endblock %}

<style>

@page {
    size: legal landscape;
    margin: 1cm;
    @frame footer {
    -pdf-frame-content: footerContent;
    bottom: 0cm;
    margin-left: 18cm;
    margin-right: 0cm;
    height: 1cm;
}
}

td, th {
    padding: 2px;
    padding-top: 3px;
}

.thin {
    padding: 0;
    margin: 0;
}

th {
    text-decoration: underline;
    font-weight: bold;
    text-align: left;
}

.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.wide-cell {
    padding-top: 5px;
    padding-bottom: 5px;
    margin-top: 2px;
    margin-bottom: 2px;
}

.very-wide-cell {
    padding-top: 5px;
    padding-bottom: 20px;
    margin-top: 2px;
    margin-bottom: 2px;
}

.show-all-borders {
    border: 1px solid black;
}

.show-top-border {
    border-top: 1px solid black;
}

.show-bottom-border {
    border-bottom: 1px solid black;
}

.grey {
    background-color: lightgray;
}

.data {
    background-color: #edf1ff;
}

.top {
    vertical-align: top;
}

.block {
    margin-bottom: 15px;
}

h1 {
    font-size: 18px;
}


.w10p {
    width: 10%;
}

.w20p {
    width: 20%;
}

.w40p {
    width: 40%;
}

.w45p {
    width: 45%;
}

.w60p {
    width: 60%;
}

.w75p {
    width: 75%;
}


.large-font {
    font-size: 18px;
}

.float-right {
    float: right;
}
</style>


<div id="footerContent">
  {% block page_foot %}
    <pdf:pagenumber/>
  {% endblock %}
</div>


<div class="block">
  <table class="show-bottom-border">
    <tr>
      <td class="w40p">
        <img src="{% static 'travel/dfo_logo.png' %}" alt="" class="float-right">
      </td>
      <td>
        <h1>{% trans "Travel Request and Approval Form" %}</h1>
      </td>
    </tr>
  </table>
</div>

{# this is the top section; left = traveller information and right = explanations #}
<div class="block">
  <table>
    <tr>
      {# TRAVELLER INFO #}
      <td class="w45p">
        <table class="show-bottom-border show-top-border">
          <tr>
            <td class="w20p">{% trans "Period Covered" %}:</td>
            <td class="data">{{ parent.start_date|date:"F d, Y" }} to {{ parent.end_date|date:"F d, Y" }}</td>
            <td class="w20p">{% trans "Plan Number (Optional)" %}:</td>
            <td class="data">{{ parent.plan_number|nz }}</td>
          </tr>
        </table>
        <table>
          <tr class="grey show-bottom-border">
            <td colspan="2" class="">
              {% trans "Traveller's Information" %}
            </td>
          </tr>
          <tr>
            <td class="w75p top">
              <table class="show-bottom-border">
                <tr>
                  <td class="w40p">{% trans "Name of Traveller" %}:</td>
                  <td class="data">{{ parent.first_name }} {{ parent.last_name }}</td>
                </tr>
                <tr>
                  <td class="w40p">{% trans "Region/Sector/Branch/<br>Directorate/Section" %}:</td>
                  <td
                    class="data">{{ parent.section.division.branch.region.name }}/{{ parent.section.division.branch.name }}/{{ parent.section.division.name }}/{{ parent.section.name }}</td>
                </tr>
                <tr>
                  <td class="w40p">{% trans "Address" %}:</td>
                  <td class="data">{{ parent.address|nz }}</td>
                </tr>
                <tr>
                  <td class="w40p">{% trans "Telephone Number" %}:</td>
                  <td class="data">{{ parent.phone|nz }}</td>
                </tr>
                <tr>
                  <td class="w40p">{% trans "Email" %}:</td>
                  <td class="data">{{ parent.email|nz }}</td>
                </tr>
              </table>
            </td>
            <td class="top">
              <table class="show-borders">
                <tr>
                  <td class="">{% trans "Public Servant" %}</td>
                </tr>
                <tr>
                  <td class="data">{{ parent.is_public_servant|yesno }}
                </tr>
                <tr>
                  <td class="">{% trans "For non public servant, provide company name" %}</td>
                </tr>
                <tr>
                  <td class="data">{{ parent.company_name|nz:"n\a" }}</td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>
      <td style="width: 10px">&nbsp;</td>
      {# EXPLANATIONS #}
      <td class="top">
        <table>
          <tr>
            <th class="w20p">{% trans "Purpose of Travel" %}</th>
            <th>{% trans "Explanation" %}</th>
          </tr>
          <tr>
            <td class="top">01 - {% trans "Title" %}</td>
            <td class="top">&nbsp;</td>
          </tr>
          <tr>
            <td class="top">02 - {% trans "Title" %}</td>
            <td class="top">&nbsp;</td>
          </tr>
          <tr>
            <td class="top">03 - {% trans "Title" %}</td>
            <td class="top">&nbsp;</td>
          </tr>
          <tr>
            <td class="top">04 - {% trans "Title" %}</td>
            <td class="top">&nbsp;</td>
          </tr>
          <tr>
            <td class="top">05 - {% trans "Title" %}</td>
            <td class="top">&nbsp;</td>
          </tr>

        </table>

      </td>
    </tr>


  </table>
</div>

{# COST BREAKDOWN #}
<div class="block">
  <table class="show-all-borders">
    <tr>
      <td rowspan="2" class="grey">{% trans "Amended" %}</td>
      <td rowspan="2" class="grey">{% trans "Trip No" %}</td>
      <td rowspan="1" colspan="2" class="grey text-center">{% trans "Date" %}</td>
      <td rowspan="2" class="grey text-center">{% trans "Origin / Destination(s) of Travel" %}</td>
      <td rowspan="1" colspan="1" class="grey text-center">{% trans "Purpose of Travel" %}</td>
      <td rowspan="1" colspan="11" class="grey text-center">{% trans "Cost Information (include taxes)" %}</td>
      <td rowspan="1" colspan="1" class="grey">{% trans "Event" %}</td>
    </tr>
    <tr class="real">
      <td class="grey">From<br>DD/MM</td>
      <td class="grey">To<br>DD/MM</td>
      <td class="grey">{% trans "Trip Purpose" %}</td>
      {% for key in my_dict|lookup:parent %}
        {% if "accom" in key.name|lower %}
          <td class="grey">{% trans "Accommo-<br>dation" %}</td>
        {% else %}
          <td class="grey">{{ key }}</td>
        {% endif %}
      {% endfor %}
      <td class="grey">{% trans "Total Trip Amount" %}</td>
      <td class="grey">{% trans "Is the trip part of an Event?" %}</td>
    </tr>
    <tr>
      <td class="data">{% trans "No" %}</td>
      <td class="data">id {{ parent.id }}</td>
      <td class="data">{{ parent.start_date|date:"d-F" }}</td>
      <td class="data">{{ parent.end_date|date:"d-F" }}</td>
      <td class="data">
        {% if parent.departure_location %}
          {{ parent.departure_location }} to
        {% endif %}
        {{ parent.destination }}
      </td>
      <td class="data">{{ parent.trip.trip_subcategory.trip_category }}</td>
      {% for key in my_dict|lookup:parent %}
        <td class="data">{{ my_dict|lookup:parent|lookup:key|currency|nz }}</td>

      {% endfor %}
      <td class="data">{{ parent.total_cost|currency|nz }}</td>
      {% if parent.trip %}
        <td class="data">{{ parent.trip.has_event_template|yesno:"yes,no,unknown" }}</td>
      {% else %}
        <td class="data">no</td>
      {% endif %}

    </tr>
    <tr>
      <td colspan="8">
        {% blocktrans %}
          If "Other" is chosen as trip purpose, provide detailed explanation and provide specific trip objective and justification for not using telepresence or
          other alternative to travel. Provide justification if agenda is not available.
        {% endblocktrans %}
      </td>
      <td colspan="10" class="data">&nbsp;</td>
    </tr>
    <tr>
      <td colspan="6">
      </td>
      {% for key in my_dict|lookup:parent %}
        <td class="">{{ my_dict|lookup:parent|lookup:key|currency|nz }}</td>
      {% endfor %}
      <td class="">{{ parent.total_cost|currency|nz }}</td>
    </tr>
  </table>

</div>

<div class="block">
  <table>
    <tr>
      <td class="top w60p">
        <table>
          <tr>
            <td class="text-right wide-cell">{% trans "Traveller" %}</td>
            <td colspan="3" class="data wide-cell">
              {{ parent.user }}
              {% if parent.submitted %}
                ({% trans "submitted on" %} {{ parent.submitted }})
              {% else %}
                ({% trans "NOT SUBMITTED" %})
              {% endif %}
            </td>
          </tr>
          <tr class="thin">
            <td class="thin">&nbsp;</td>
          </tr>
          <tr>
            <td class="text-right wide-cell">{% trans "Expenditure Initiation approved by (Print)" %}</td>
            <td class="data wide-cell" colspan="3">
              {{ parent.rdg.user |nz:"n/a" }}
              {% if parent.rdg.user %} | Regional Director General | {{ parent.rdg.user.shared_models_regions.first }}
              {% endif %}
            </td>
          </tr>
          <tr class="thin">
            <td class="thin">&nbsp;</td>
          </tr>
          <tr>
            {% if parent.rdg.status_id == 2 %}
              <td class="text-right wide-cell w50p"> &nbsp;</td>
              <td class="data wide-cell large-font">{% trans "Approved on" %} {{ parent.rdg.status_date }}</td>
              <td class="text-right wide-cell">&nbsp;</td>
              <td class="data wide-cell">&nbsp;</td>
            {% else %}
              <td class="text-right very-wide-cell w40p">{% trans "Signature" %}</td>
              <td class="data wide-cell"> &nbsp;</td>
              <td class="text-right wide-cell w10p">{% trans "Date" %}</td>
              <td class="data wide-cell"> &nbsp;</td>
            {% endif %}
          </tr>
        </table>
      </td>
      <td class="top">
        <table>
          {% for r in parent.recommenders %}
            {% if not r.status_id == 21 %}
              <tr>
                <td class="text-right wide-cell top">{% trans "Recommended by" %}</td>
                <td rowspan="1" class="data wide-cell">
                  {{ r.user }}
                  {% if r.status_id == 2 %}
                    ({% trans "digitally reviewed" %} on {{ r.status_date }})
                  {% else %}
                    ({% trans "NOT RECOMMENDED" %})
                  {% endif %}
                </td>
              </tr>
            {% endif %}
          {% endfor %}
          {% if parent.adm.status_id == 2 %}
            <tr>
              <th class="right wide-cell">Approved by:</th>
              <td rowspan="1" class="left wide-cell">
                {{ parent.adm.user }} on {{ parent.adm.status_date }}
              </td>
            </tr>
          {% endif %}
        </table>
      </td>
    </tr>
  </table>
</div>

<div class="block">
  <table>
    <tr>
      <td class="w10p">{% trans "Comments" %}</td>
      <td class="data wide-cell">

        <table>
          <tr>
            <td class="top">
              {{ parent.purpose_long|safe }}
            </td>
            <td class="top">
              {% trans "DETAILED COST BREAKDOWN" %}:<br> {{ parent.cost_breakdown }}
            </td>
          </tr>
        </table>
      </td>

    </tr>
  </table>


</div>