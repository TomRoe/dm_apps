{% extends "travel/generic_base.html" %}
{% load static %}
{% load bootstrap4 %}
{% load verbose_names %}
{% load custom_filters %}
{% load i18n %}
{% load custom_tags %}

{% block subcontent %}


    <form method="post" class="form">
        {% csrf_token %}

        {{ formset.management_form }}
        {% bootstrap_formset_errors formset %}
        <div class="mt-3 mb-3">
            <input type="submit" class="btn btn-primary" value=
                    "{% if not submit_text %}{% trans "Save" %}{% else %}{{ submit_text }}{% endif %}">

            <a class="btn btn-secondary" href="{{ back_url }}">
                {% if not cancel_text %}
                    {% trans "Back" %}
                {% else %}
                    {{ cancel_text }}
                {% endif %}
            </a>
        </div>
        <br><br>
        <table class="table" >
            <thead>
            <th>Id</th>
            {% for field in field_list %}
                <th scope="col">{% get_verbose_label random_object field %}</th>
            {% endfor %}
            </thead>
            <tbody>
            {% for form in formset %}
                <tr>
                    <td>{{ form.instance.id|nz:"---" }}</td>
                    {% for field in form %}
                        <td {% if field.name == "color" %}class="color-cell" color-value="{{ form.instance.color }}"{% endif %}>
                            {% bootstrap_field field size='small' show_label=False placeholder="" %}
                        </td>
                    {% endfor %}
                    {% if form.instance.id %}
                        {% if delete_url_name %}
                            <td>
                                <a class="delete-btn" href="#" delete_url="{% url delete_url_name form.instance.id %}">
                                    <img src="{% static "/admin/img/icon-deletelink.svg" %}" data-toggle="tooltip" title="Delete">
                                </a>
                            </td>
                        {% endif %}
                    {% else %}
                        <td>(new record)</td>
                    {% endif %}
                </tr>
            {% endfor %}

            </tbody>
        </table>

        <div class="mt-3 mb-3">
            <input type="submit" class="btn btn-primary" value=
                    "{% if not submit_text %}{% trans "Save" %}{% else %}{{ submit_text }}{% endif %}">

            <a class="btn btn-secondary" href="{{ back_url }}">
                {% if not cancel_text %}
                    {% trans "Back" %}
                {% else %}
                    {{ cancel_text }}
                {% endif %}
            </a>
        </div>

    </form>

    {% block post_form_p %}{% endblock %}
{% endblock %}
{% block body_js %}
    <script type="application/javascript">

        $(".delete-btn").click(function () {
            input = confirm("Are you sure you want to delete this line?");
            if (input) {
                window.location.href = $(this).attr("delete_url");
            }
        });

        $(".color-cell").each(function () {
            let myColor = $(this).attr("color-value");
            $(this).children().children("input").css("background-color", myColor);
        });


    </script>

{% endblock %}