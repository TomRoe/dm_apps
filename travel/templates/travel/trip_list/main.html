{% extends 'travel/base.html' %}
{% load verbose_names %}
{% load i18n %}
{% load custom_filters %}
{% load static %}

{% block title_area %}

{% endblock %}

{% block subcontent %}
  <div id="app" v-cloak>

    <h1 v-if="pageType=== 'all'">{% trans "All Trips" %}</h1>
    <h1 v-else-if="pageType=== 'regional-verification'">{% trans "Regional Trips Awaiting Verification" %}</h1>
    <h1 v-else-if="pageType=== 'adm-verification'">{% trans "ADM Trips Awaiting Verification" %}</h1>
    <h1 v-else-if="pageType=== 'adm-hit-list'">{% trans "Trips Eligible for ADM Review" %}</h1>
    <h1 v-else>{% trans "Upcoming Trips" %}</h1>

    <h3 v-if="pageType=== 'adm-hit-list'">{% trans "(i.e., Trips which are fair game for ADMO review to begin)" %}</h3>

    <div>

      <div class="row container-fluid bg-light curvy">
        <div class="col">
          <div v-if="(pageType.search('verification') > -1 || pageType.search('adm') > -1) && !trips.length && !trips_loading">
            <div class="text-center">
              <img src="{% static 'travel/you_are_done.png' %}" alt="">
              <h3>Way to go! You're all done here :)</h3>
            </div>
          </div>

          <div v-else>
            <div>
              {% include "travel/trip_list/_console.html" %}
            </div>

            <div class="float-right" v-if="currentUser.is_admin && pageType == 'all'">
              <a class="mb-3 btn btn-sm btn-primary" href="{% url 'travel:trip_new' %}">{% trans "New Trip" %}</a>
            </div>

            <div>
              <div class="text-center">
                <p class="font-italic font-weight-bold">${trips.length} of ${count} loaded</p>
              </div>
            </div>
            <table class="table table-sm table-hover">
              <thead>
              <tr>
                {% for field in field_list %}
                  {% if "title" in field %}
                    <th style="width: 200px" @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% elif "fiscal" in field or "funding" in field %}
                    <th style="width: 75px" @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% elif "status" in field %}
                    <th style="width: 150px" @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% elif "subcategory" in field %}
                    <th style="width: 200px" @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% elif "dates" in field %}
                    <th style="width: 170px" @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% elif "date_eligible_for_adm_review" in field %}
                    <th style="width: 140px" @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% else %}
                    <th @click="sort('{{ field }}')" class="clickable">
                      {% get_verbose_label random_object field %}
                    </th>
                  {% endif %}

                {% endfor %}

              </tr>
              </thead>
              <tbody v-if="trips.length">
              <tr
                v-for="(t, index) in sortedTrips"
                @click="goRow(t)"
                class="pointy"
              >
                <td>${t.fiscal_year }</td>
                <td :class="t.status_class">${t.status_display }</td>
                <td>${t.trip_subcategory }</td>
                <td>${t.tname }</td>
                <td>${t.location }</td>
                <td>${t.abstract_deadline }</td>
                <td>${t.registration_deadline }</td>
                <td v-html="t.dates"></td>
                <td>${t.is_adm_approval_required | yesNo}</td>
                <td>${t.date_eligible_for_adm_review }</td>
              </tr>
              </tbody>
            </table>

            <div v-if="trips_loading" class="loading mb-3 mt-3 text-center mt-5">
              <div class="spinner-border mb-3" style="width: 10rem; height: 10rem;" role="status">
                <span class="sr-only"></span>
              </div>
            </div>
            <div v-else>
              <div class="text-center">
                <p class="font-italic font-weight-bold">${trips.length} of ${count} loaded</p>
                <button v-if="next" @click="loadMoreResults" class="btn btn-primary btn-sm">
                  {% trans "Load more results..." %}
                </button>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>


{% endblock %}


{% block body_js %}
  {{ block.super }}

  <script src="{% static '/travel/mainTripList.js' %}?version=0.6" type="application/javascript"></script>
  <script type="application/javascript">
  //reload other scripts that we care about
  </script>


{% endblock %}