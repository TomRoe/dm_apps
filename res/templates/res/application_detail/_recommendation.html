{% load i18n %}

<div v-if="loadingRecommendation" class="loading mb-3 mt-3 mt-5">
  <div class="spinner-border mb-3" style="width: 5rem; height: 5rem;" role="status">
    <span class="sr-only"></span>
  </div>
</div>

<div class="table table-sm">
  <editable-cell
    key="r1"
    :label="recommendationLabels.recommendation_text" :object="recommendation" field="recommendation_text"
    display_field="recommendation_text_html"
    input_type="textarea" :markdown="true"
    :editable="canModifyRecommendation" :dirty="unsavedChanges"
    @change="updateRecommendation" @keypress="unsavedChanges=true"
  ></editable-cell>

  <editable-cell
    key="r2"
    :label="recommendationLabels.decision"
    :object="recommendation" field="decision" display_field="decision_display"
    :editable="canModifyRecommendation" input_type="select" :options="decisionChoices"
    @keypress="unsavedChanges=true" @change="updateRecommendation"
  ></editable-cell>

  <div class="row table-div">
    <div class="col-2">
      <label for="">
        ${recommendationLabels.manager_signed}
      </label>
    </div>
    <div class="col">
      <div v-if="recommendation.manager_signed">
        ${recommendation.manager_signed_display}
      </div>
      <div v-else-if="isManager && application.submission_date">
        <div v-if="recommendation.decision === null || recommendation.recommendation_text === null">
          <span data-toggle="tooltip" title="{% trans "Cannot sign until all required fields have been completed." %}">
            <button class="btn btn-xs btn-danger helper" disabled>{% trans "Sign Now!" %}</button>
          </span>
        </div>
        <div v-else>
          <button @click="updateRecommendation(recommendation, 'sign-by-manager')" class="btn btn-xs btn-danger">{% trans "Sign Now!" %}</button>
        </div>
      </div>
      <div v-else>
        -----
      </div>
    </div>
  </div>


  <div class="row table-div">
    <div class="col-2">
      <label for="">
        ${recommendationLabels.applicant_signed}
      </label>
    </div>
    <div class="col">
      <div v-if="recommendation.applicant_signed">
        ${recommendation.applicant_signed_display}
      </div>
      <div v-else-if="isApplicant && application.submission_date">
        <div v-if="!recommendation.manager_signed">
          <span data-toggle="tooltip" title="{% trans "Cannot sign until has been signed by manager." %}">
            <button class="btn btn-xs btn-danger helper" disabled>{% trans "Sign Now!" %}</button>
          </span>
        </div>
        <div v-else>
          <button @click="updateRecommendation(recommendation, 'sign-by-applicant')" class="btn btn-xs btn-danger">{% trans "Sign Now!" %}</button>
        </div>
      </div>
      <div v-else>
        -----
      </div>
    </div>
  </div>


  <editable-cell
    key="r3"
    :label="recommendationLabels.applicant_comment"
    :object="recommendation"
    field="applicant_comment_html"
    null_mark="-----"
  ></editable-cell>

  <editable-cell
    key="r4"
    label="{% trans "Metadata" %}"
    :object="application"
    field="metadata"
  ></editable-cell>


</div>