{% load i18n %}

<!-- template for the modal component -->
<script type="text/x-template" id="editable-cell-template">

<div class="row table-div">
  <div class="col-2">
    <label for="my-input">${label}</label>
  </div>
  <div v-if="!editMode" class="col">
    <div class="row">
      <div class="col">
        <div v-if="display_field">
          <span v-if="object[display_field]" v-html="object[display_field]"></span>
          <div v-else>
            <span v-if="null_mark" v-html="null_mark"></span>
            <em v-else class="red-font">{% trans "missing" %}</em>
          </div>
        </div>
        <div v-else>
          <span v-if="object[field]" v-html="object[field]"></span>
          <div v-else>
            <span v-if="null_mark" v-html="null_mark"></span>
            <em v-else class="red-font">{% trans "missing" %}</em>
          </div>
        </div>
      </div>
      <div v-if="editable" class="col-1 text-right">
        <button class="btn btn-sm btn-light" @click="toggleEditMode"><span class="mdi mdi-pencil"></span></button>
      </div>
    </div>
  </div>
  <div v-else class="col">
    <div class="row">
      <div class="col">
        <select
          class="form-control"
          v-if="input_type==='select'"
          v-model="input"
          @change="update"
          ref="input"
          id="my-input"
          @keypress="$emit('keypress')"
        >
          <option value="">${blankOption}</option>
          <option v-for="(option, index) in options" :value="option.value">${option.text}</option>
        </select>
        <textarea
          class="form-control"
          v-else-if="input_type==='textarea'"
          v-model="input"
          @change="update"
          ref="input"
          :rows="rows"
          id="my-input"
          @keypress="$emit('keypress')"
        ></textarea>
        <div v-else>
          <input
            :type="input_type" class="form-control" step="any"
            v-model="input"
            @change="update"
            ref="input"
            id="my-input"
            @keypress="$emit('keypress')"
            list="mydatalist"
          >
          <datalist v-if="options && options.length" id="mydatalist">
            <option v-for="(obj, index) in options" :value="obj.value"></option>
          </datalist>
        </div>
        <a v-if="markdown" href="https://daringfireball.net/projects/markdown/syntax" data-toggle="tooltip" target="_blank" tabindex="-1"
           title="{% trans "Markdown syntax is supported in this field" %}">
          <span class="mdi mdi-language-markdown ml-1 py-0 lead helper" style="color: blue"></span>
        </a>
      </div>
      <div class="col-1">
        <button class="btn btn-xs btn-success" @click="toggleEditMode"><span class="mdi mdi-check text-light"></span></button>
      </div>
    </div>
  </div>

</div>


</script>
<script type=" application/javascript">

Vue.component("editable-cell", {
  template: "#editable-cell-template",
  delimiters: ["${", "}"],
  name: "editable-cell",
  props: {
    editable: {
      type: Boolean,
      default: false
    },
    field: {
      type: String,
      required: true
    },
    display_field: {
      type: String,
    },
    markdown: {
      type: Boolean,
      default: false
    },
    object: {
      type: Object,
    },
    input_type: {
      type: String,
      default: "text"
    },
    label: {
      type: String,
    },
    rows: {
      default: "10"
    },
    options: {
      type: Array,
      required: false
    },
    null_mark: {
      type: String,
    },
    blank_option: {
      type: String,
      required: false
    },
  },
  data() {
    return {
      input: this.object[this.field],
      editMode: false,
    };
  },
  methods: {
    toggleEditMode() {
      this.editMode = !this.editMode;
    },
    update() {
      this.object[this.field] = this.input
      this.$emit("change", this.object)
    }
  },
  watch: {
    object() {
      this.input = this.object[this.field];
    }
  },
  computed: {
    blankOption() {
      if (this.blank_option) return this.blank_option;
      else return "-----";
    }
  }
});
</script>