{% extends "grais/grais_base.html" %}
{% load static %}
{% load percentage %}
{% load bootstrap4 %}

{% block content %}
{% if temp_msg %}
  {% bootstrap_alert temp_msg alert_type='success' %}
{% endif %}

<div class="nav-map">
  <p><br>
    <a href="{% url 'grais:sample_list' %}">All samples</a> >
    <a href="{% url 'grais:sample_detail' surface.line.sample.id %}"> {{surface.line.sample}}</a> >
    <a href="{% url 'grais:line_detail' surface.line.id %}"> {{surface.line}}</a> >
    <a href="{% url 'grais:surface_detail' surface.id %}"> {{surface}}</a> >
    Insert Species
  </p><br>
</div>

<div class="container">
  <h1>Add Species to {{surface}}</h1>

  <form action="." method="get">
    <div class="row">
      <div class="col-8">
        <table>
          <tr>
            {% for field in filter.form  %}
            <td>
              <em>{{field.label}}:</em> &nbsp;{{field}}&nbsp;&nbsp;
            </td>
            {% endfor %}
            <td>
              <div class="btn-group">
                <input type="submit" value="Filter" class="btn btn-warning" />
{#                <a class="btn btn-info" href=".">Clear</a>#}
              </div>
            </td>
          </tr>
        </table>

      </div>

    </div>
   </form>
   <br>

   <div class="container">
     <div class="row">

       <div class="col">


         <h3>Species List:</h3>
            <h5>(common / latin / abbreviation)</h5>

         <div class="scroll-med">
           {% for sp in object_list.all %}
           <p class="indent">
             <a class="btn btn-outline-dark" href="#" onclick="return popitup('{% url 'grais:surface_spp_new_pop' surface.id sp.id %}','surfaceSpeciesNew')">
                 <img src="{% static 'admin/img/icon-addlink.svg'%}" alt="">
             </a>
               {{sp.common_name}} / <em>{{ sp.scientific_name }}</em> / {{ sp.abbrev }}
           </p>
           {% endfor %}

         </div>
         <br>
           <a class="btn btn-sm btn-primary" href="{% url 'grais:species_add' surface.id %}" target="_blank">Add New Species</a>

       </div>

       <div class="col">


           {% if surface.image %}
             <a href="{{surface.image.url}}">
               <img src="{{surface.image.url}}" alt="problem locating surface image {{surface.image.url}}" class="img-thumbnail" width ="400 em">
             </a>

             {#  display the image #}
           {% else %}
             <em>
               No image has been added.
             </em>
           {% endif %}<br><br>


            <h3>Added:</h3>
           <table class="table table-bordered ">
             <thead class="full-table">
               <th>Species name</th>
               <th>Coverage (%)</th>
             </thead>
             <tbody>
               {% for s in surface_spp  %}
                 <tr>
                   <td>{{s.species.common_name}} (<em>{{ s.species.scientific_name }}</em>)</td>
                   <td>{{s.percent_coverage|percentage}}</td>
                    <td>
                      <a href="#" onclick="return popitup('{% url 'grais:surface_spp_edit_pop' s.id %}','surfaceSpeciesEdit')">
                        <img src="{% static "/admin/img/icon-changelink.svg" %}" data-toggle="tooltip" title="Edit">
                      </a>
                    </td>
                    <td>
                        <a class="delete-me" href="#" val="{{s.id}}">
                            <img src="{% static "/admin/img/icon-deletelink.svg" %}" data-toggle="tooltip" title="Delete">
                        </a>
                        <a id="secrect-delete-btn-{{ s.id }}" href="{% url 'grais:surface_spp_delete' s.id "insert" %}" class="hidden"></a>
                    </td>







                       <img src="" alt="">
                   </a></td>

                 </tr>
               {% empty %}
                 {# empty #}
               {% endfor %}
               <tr>
                 <td> <b>TOTAL:</b> </td>
                 <td> <b>{{total_coverage|percentage}}</b></td>
               </tr>
             </tbody>
           </table>



         <script type="text/javascript" src="{% static "js/popItOut.js" %}"></script>


       </div>


   </div>




   </div>

</div>


<script type="application/javascript">
    $(".delete-me").click(function () {
        var objectId = $(this)[0].getAttribute("val");

        var userInput = "";
        while (userInput !== "n" && userInput !== "y") {
            userInput = prompt("Are you sure you want to delete this species from the surface? \n\n Please respond with 'y' for yes and 'n' for no.").toLocaleLowerCase();

        }
        if(userInput === "y") {
          $("#secrect-delete-btn-"+objectId)[0].click();
        }
    })
</script>


{% endblock content %}
