{% extends "base.html" %}
{% load static %}
{% load custom_tags %}

{% block content %}

<div class="nav-map">
  <p><br>
    <a href="{% url 'biofouling:sample_list' %}">All samples</a> >
    <a href="{% url 'biofouling:sample_detail' view.kwargs.sample %}">Sample {{view.kwargs.sample}}</a> >
    <a href="{% url 'biofouling:line_detail' view.kwargs.sample view.kwargs.line %}">Line {{object.line}}</a> >
    Surface {{object.id}}
  </p><br>
</div>

<div class="container">
  <h1>Surface {{object.id}}</h1>

  {# <h1>{{object.get_surface_type_display|title}} {{object.label}} on Line #{{object.line}}</h1> #}
  <p>
    <a class="btn btn-outline-primary" href="{% url "biofouling:surface_spp_insert" object.line.sample.id object.line.id object.id %}"> Add Species</a>
    <a class="btn btn-outline-primary" href="#" id="myBtn">Add Image</a>
    <a class="btn btn-warning" href="{% url 'biofouling:surface_edit' view.kwargs.sample view.kwargs.line object.id %}">Edit</a>
    {% if object.surface_spp.count > 0  %}
      <a class="btn btn-danger disabled" href="{% url 'biofouling:surface_delete' view.kwargs.sample view.kwargs.line object.id %}">Delete</a>
    {% else %}
      <a class="btn btn-danger" href="{% url 'biofouling:surface_delete' view.kwargs.sample view.kwargs.line object.id %}">Delete</a>
    {% endif %}

  </p>


  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      {% include "biofouling/_surface_image_form.html" %}
    </div>
  </div>
  <script src="{% static "js/modal.js" %}"></script>

  <br>
  <div class="row">
    <div class="col">
      {# Detail about the sample #}


      <p>
        <b>Surface type:</b><br>
        {{object.get_surface_type_display}}
      </p>

      <p>
        <b>Notes:</b><br>
        {{object.notes}}
      </p>
      <p>
        <b>Last modified by:</b><br>
        {% if object.last_modified_by %}
          @{{object.last_modified_by}}
        {% else %}
          n/a
        {% endif %}
      </p>
    </div>
      <div class="col">


      {% if object.image %}
        <a href="{{object.image.url}}">
          <img src="{{object.image.url}}" alt="problem locating surface image {{object.image.url}}" class="img-thumbnail" width ="400 em">
        </a>

        {#  display the image #}
      {% else %}
        <em>
          No image has been added.
        </em>
      {% endif %}

        </div>
      </div>
<br><br>
    {#  SPECIES OBSERVED #}
      <h3>
        Species Observations:
        {# <a class="btn btn-sm btn-light" onclick="return popitup('{% url "biofouling:surface_spp_insert" object.line.sample.id object.line.id object.id %}','sppInsert')"> <i class="material-icons">add</i></a> #}
        {# <a class="btn btn-sm btn-light" href="{% url "biofouling:surface_spp_insert" object.line.sample.id object.line.id object.id %}"> <i class="material-icons">add</i></a> #}
      </h3>
      <table class="table table-bordered ">
        <thead class="full-table">
          <th>#</th>
          <th>Common name</th>
          <th>Scientific name</th>
          <th>Abbreviation</th>
          <th>Percent coverage (%)</th>
          <th>Invasive</th>
          <th>Biofouling</th>
        </thead>
        <tbody>
          {% for s in object.surface_spp.all  %}
            <tr>
              <td><a href="#" onclick="return popitup('{% url 'biofouling:surface_spp_detail_pop' view.kwargs.sample view.kwargs.line surface.id s.id %}','surfaceSpeciesView')">{{forloop.counter}}</a></td>
              <td>{{s.species.common_name}}</td>
              <td><em>{{s.species.scientific_name}}</em></td>
              <td>{{s.species.abbrev}}</td>
              <td>{{s.percent_coverage|percentage}}</td>

              {% if s.species.invasive == True %}
                <td class="bad">
              {% else %}
                <td>
              {% endif %}
              {{s.species.invasive|yesno}}</td>

              {% if s.species.biofouling == True %}
                <td class="bad">
              {% else %}
                <td>
              {% endif %}
              {{s.species.biofouling|yesno}}</td>
            </tr>
          {% empty %}
            {# empty #}
          {% endfor %}

        </tbody>

      </table>
      <p>
        <b>TOTAL COVERAGE: {{total_coverage|percentage}}</b>
      </p>
</div>

</div>

{% endblock content %}
