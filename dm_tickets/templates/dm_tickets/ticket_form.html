{% extends "dm_tickets/dm_tickets_base.html" %}

{% load bootstrap4 %}

{% block content %}

    <div class="container">

        <div class="neighbours" style="padding-right: 100px">
        {# Load js file to allow for popout window #}
        {% load static %}
        <script type="text/javascript" src="{% static "js/popItOut.js" %}"></script>

        {% if object.id %}

            <h1>{{object.title}}</h1>
        {% else %}
            <h1>New Ticket</h1>
        {% endif %}
        {% bootstrap_form_errors form %}

        </div>


        <div class="neighbours">
        {% if not object %}
            <div class="dropdown ">
            <button class="btn btn-outline-dark dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Load template
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#" id="prefill-monitor">monitor</a>
              <a class="dropdown-item" href="#" id="prefill-computer">computer</a>
              <a class="dropdown-item" href="#" id="prefill-software">software</a>
            </div>
          </div>

        {% endif %}

        </div>

    

        <form method="post" class="form">
            {% csrf_token %}
            {# {% bootstrap_form form %} #}
            {% for field in form  %}


                {% if field.name == 'primary_contact' %}
                    {% bootstrap_label field.label %}
                    {# function popitup(url,windowName, height=500, width=500,top=50,left=200) #}
                    (<a href="#" onclick="return popitup('{% url 'tickets:person_create' %}','RequestTypeCreate',300,500)">new person</a>)
                    {% bootstrap_field field show_label=False %}


                {% else %}
                    {% bootstrap_field field%}
                {% endif %}

            {% endfor %}

            <script type="text/javascript">
                var user_name = "{{ user }}";
            </script>




            {% buttons %}
                <button type="submit" class="btn btn-primary">Submit</button>
                {% if object.id %}
                    <a class="btn btn-secondary" href="{% url 'tickets:detail' object.id %}">Cancel</a>
                {% else %}
                    <a class="btn btn-secondary" href="{% url 'tickets:list' %}">Cancel</a>
                {% endif %}
            {% endbuttons %}
        </form>
    </div>



<script type="text/javascript">
  //
  var updatePrimaryContactEmail = function () {
    //retrieve the PC email address
    var emailLookup = '{{email_json|safe}}';
    var obj = JSON.parse(emailLookup);
    var userId = $("#id_primary_contact").val();
    $("#id_primary_contact_email").val(obj[userId]);
  }

  // when the doc is loaded.. call updatePrimaryContactEmail()
  $(document).ready(updatePrimaryContactEmail)

  // when the primary contact is changed
  $("#id_primary_contact").change(updatePrimaryContactEmail)

    $("#prefill-monitor").click(function () {
        $("#id_title").val("Request for new monitor")
        $("#id_description").val("Request for new monitor")
        $("#id_sd_description").val("Request for new monitor")
        $("#id_sd_primary_contact").val("50")
        $("#id_financial_coding").val("xxx-xxx-xxx-0930-xxx")
        $("#id_request_type").val("6")
        $("#id_generic_file_to_load").val("monitor")
    })


    $("#prefill-computer").click(function () {
        $("#id_title").val("Request for NEW / REPLACEMENT computer")
        $("#id_description").val("Request for NEW / REPLACEMENT computer")
        $("#id_sd_description").val("Request for NEW / REPLACEMENT computer")
        $("#id_sd_primary_contact").val("50")
        $("#id_financial_coding").val("xxx-xxx-xxx-0930-xxx")
        $("#id_request_type").val("6")
        $("#id_generic_file_to_load").val("computer")
    })

    $("#prefill-software").click(function () {
        $("#id_title").val("Request for software XXXXXXXXXXXXX")
        $("#id_description").val("Request for software XXXXXXXXXXXXX")
        $("#id_sd_description").val("Request for software XXXXXXXXXXXXX")
        $("#id_sd_primary_contact").val("50")
        $("#id_financial_coding").val("xxx-xxx-xxx-0931-xxx")
        $("#id_request_type").val("6")
        $("#id_generic_file_to_load").val("software")
    })

</script>

{% endblock content %}
