{% extends "herring/herring_base.html" %}

{% load bootstrap4 %}
{% load verbose_names %}
{% load percentage %}
{% load divide %}
{% load static %}

{% block content %}
<div class="nav-map">
<br>
  <p>
    <a href="{% url 'herring:sample_list' %}">All Samples</a> >
    <a href="{% url 'herring:port_sample_detail' object.sample.id %}">Sample {{object.sample.id}}</a> >
    Fish {{object.id}}
  </p>
</div>

{# <embed src="{% static "/sounds/success.wav" %}" autostart="false" width="0" height="0" id="sound1" enablejavascript="true"> #}

<style media="screen">
  .indent-med{
    font-size: .9em;
  }
  label{
    font-weight: bold;
  }
</style>

<div class="indent-med">

  <h1>
    Fish #{{object.fish_number}}
  </h1>


  <br><br>

  <div class="row">
    <div class="col-5">
      <h4>Otolith Detail:</h4>
      <form method="post">
        {% csrf_token %}
        <input type="submit" value="submit" class="hidden">
        {% for field in form %}
          {%bootstrap_field field layout='horizontal'%}

        {% endfor %}
        <input type="submit" name="" value="Save" class="btn btn-primary">
        <a class="btn btn-secondary" href="{% url 'herring:port_sample_detail' object.sample.id %}">Next</a>
      </form>

    </div>
    <div class="col-1">

    </div>
    <div class="col-5">
      {% include "herring/_otolith_qc.html" %}

    </div>
  </div>
  <br>
  <div class="btn-group ">
    <a class="btn btn-warning" href="#" id="myBtn">Preview Fish Detail</a>

  </div>


</div>


<!-- The Modal -->
<!-- Modal content -->
<div id="myModal" class="modal">
  <div class="modal-content">
    {# <h1>Review Email:</h1> #}
    {% include "herring/_lab_sample_metadata.html" %}

    <p>
      <span class="label">Fish lenth:</span>
      <span class="value">{{object.fish_length}} mm</span> <br>

      <span class="label">Fish weight:</span>
      <span class="value">{{object.fish_weight}} g</span> <br>

      <span class="label">Sex:</span>
      <span class="value">{{object.sex}}</span> <br>

      <span class="label">Maturity:</span>
      <span class="value">{{object.maturity}}</span> <br>

      <span class="label">Gonad weight:</span>
      <span class="value">{{object.gonad_weight}} g</span> <br>
    </p>

    <div class="container">

      <a href="#" class="btn btn-lg btn-primary float-center closeBtn">Close</a>
      {# <a href="{% url 'inventory:send_certification_email' object.user_id %}" class="btn btn-lg btn-warning float-center">Send Away!</a> #}
    </div>
  </div>


</div>

<script type="text/javascript">
  // var keepPrompting = true;
  var clickSubmit = false;
  var progress = {{progress}};
  var totalTests = {{total_tests}};
  var test200Passed = "{{test_200}}";

  var qcFeedbackLookup = '{{qc_feedback_json|safe}}';
  var qcFeedbackObject = JSON.parse(qcFeedbackLookup);


  var newRecordURL = "{% url 'herring:lab_sample_primer' object.sample.id %}"

  $(document).ready(function () {

    improbableMeasurementValidation()

    $("#id_annulus_count").focus();
  })


  function improbableMeasurementValidation() {
    var userInput
    // JSON atributes to check
    check_list = ["annulus_count", "global_209"]

    for (var i = 0; i < check_list.length; i++) {
      if (jQuery.isEmptyObject(qcFeedbackObject[check_list[i]]) == false) {
        // means there is a problem that needs dealing with

        while (userInput != "y" && userInput != "n") {
          userInput = prompt(qcFeedbackObject[check_list[i]].msg)
        }
        if (userInput == 'y') {
          // if user is confident, we will communicate this back to the server and mark yes for accepted
          $("#id_improbable_field").val(check_list[i]);
          $("#id_improbable_test").val(qcFeedbackObject[check_list[i]].test);
          $("#id_improbable_accepted").val(1);
          $("form").submit()

        }
        break
      }
    }
  }



</script>


{% endblock content %}
