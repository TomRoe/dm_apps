{% extends "herring/herring_base.html" %}

{% load bootstrap4 %}
{% load verbose_names %}
{% load nz %}
{% load percentage %}
{% load divide %}
{% load static %}

{% block content %}
<div class="nav-map">
<br>
  <p>
    <a href="{% url 'herring:sample_list' %}">All Samples</a> >
    <a href="{% url 'herring:port_sample_detail' object.sample.id %}">Sample {{object.sample.id}}</a> >
    Fish {{object.id}}
  </p>
</div>

{# <embed src="{% static "/sounds/success.wav" %}" autostart="false" width="0" height="0" id="sound1" enablejavascript="true"> #}

<div class="container">

  <h1>
    Fish #{{object.fish_number}}
    <div class="float-right btn-group">
      {# <button type="button" class="btn btn-lg btn-info">View Commands</button> #}
      {# <button type="button" id="startDataCapture" class="btn btn-lg btn-success">Click to Start Data Capture!</button> #}

    </div>
  </h1>
  <hr>
  <input type="text" placeholder="Input here!" id="prompt" class="form-control"><br>
  <form method="post">
    {% csrf_token %}
    <input type="submit" value="submit" class="btn btn-sm btn-primary"><br><br>
    <span class="red-font">{{form}}</span>
  </form>

  <p>
    <h4>Metadata:</h4>
    <b>Sample ID:</b> {{object.sample.id}} <br>
    <b>Fish ID:</b> {{object.id}} <br>
    <b>Sample Collection date:</b> {{object.sample.sample_date|date:"F m, Y"}} <br>
    <b>Sample Collected by:</b> {{object.sample.sampler}} <br>
    <b>Sampler's reference no.:</b> {{object.sample.sampler_ref_number}} <br>
    <b>Last modified:</b> {{object.last_modified_date|date:"F m, Y"}} <br>
    <b>Last modified by:</b> {{object.last_modified_by}} <br>
  </p>
  <p>
    <h4>Measurement Data:</h4>
    <b>Fish number:</b> {{object.fish_number}} <br>
    <b>Fish length (mm):</b> {{object.fish_length|nz:""}} <br>
    <b>Fish weight (g):</b> {{object.fish_weight|nz:""}} <br>
    <b>Sex:</b> {{object.sex|nz:""}} <br>
    <b>Maturity:</b> {{object.maturity|nz:""}} <br>
    <b>Gonad weight:</b> {{object.gonad_weight|nz:""}} <br>
    <b>Parasite present:</b> {{object.parasite|yesno:"yes,no,not-specified"}} <br>
    <b>Remarks:</b> {{object.remarks|nz:""}} <br>
  </p>



  <p>
    <h4>Progress Complete:</h4>
    <div class="progress" style="height: 60px;">
      <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: {{progress|divide:6|percentage}};" aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="6"></div>
    </div>
    <em>
      {{progress}} of 6 meaurements complete
    </em>
  </p>


<script type="text/javascript">
  var keepPrompting = true;
  var clickSubmit = true;
  var audio = new Audio("{% static "/sounds/success2.wav" %}");
  audio.onended = function () {
    $("input").click();
  }
  $(document).ready(function () {
    $("#prompt").focus()
  })

  $("#prompt").keypress(function(e) {
    if(e.which == 13) {
      clickSubmit = true;
      userResponse = $("#prompt").val();
      userResponse = userResponse.trim()

      if (userResponse == 'h') {
        // open help modal
      } else if (userResponse.match(/comment/gi)) {
        $("#id_remarks").val(userResponse.toLowerCase().replace("comment","").trim());
      } else if (userResponse.match(/ruler1/gi)) {
        // EXAMPLE:  Ruler1 279.2123
        $("#id_fish_length").val(userResponse.toLowerCase().replace("ruler1","").trim());
      } else if (userResponse.match(/sex/gi)) {
        // 'EXAMPLE:  Sex male
        strSex = userResponse.toLowerCase().replace("sex","").trim()
        if (strSex=='male') {
          $("#id_sex").val(1);
        } else if (strSex=='female') {
          $("#id_sex").val(2);
        } else if (strSex=='h') {
          $("#id_sex").val(3);
        } else if (strSex=='u') {
          $("#id_sex").val(9);
        }
      } else if (userResponse.match(/parasites/gi)) {
        // 'EXAMPLE:  Parasites Y
        strParasite = userResponse.toLowerCase().replace("parasites","").trim()
        if (strParasite=='y') {
          $("#id_parasite").val(1);
        } else if (strParasite=='n') {
          $("#id_parasite").val(0);
        }

      } else if (userResponse.match(/Gonad/gi) || userResponse.match(/scale_2/gi)) {
        // 'EXAMPLE:  Enter Gonad wt 50.1 __OR__ Scale_2 50.0001 g
        if (userResponse.match(/Gonad/gi)) {
          $("#id_gonad_weight").val(userResponse.toLowerCase().replace("enter Gonad wt","").trim());
        } else {
          $("#id_gonad_weight").val(userResponse.toLowerCase().replace("scale_2","").trim());
        }
        console.log($("#id_gonad_weight").val());

      } else {
        clickSubmit = false
      }

      if (clickSubmit == true) {
        audio.play();

      } else {
        $("#prompt").val("");
      }
    }
  });


</script>
{% endblock content %}
