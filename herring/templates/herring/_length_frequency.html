{% load static %}
{% load divide %}
{% load percentage %}
<h4>Length Frequencies:</h4>

{% if object.length_frequencies.count == 0  %}
<br>
<p>
  <em>
    No length frequencies have been entered for this sample.
  </em>
</p>

{% else %}

<br>
<button class='btn btn-sm btn-dark' id="read-aloud"> Read back list </button>
<br><br>

<table>
  {% for freq in object.length_frequency_objects.all  %}
  <tr>
    <td>{{freq.length_bin}}&nbsp;</td>
    <td width = "70%">
      <div class="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="{{freq.count}}" aria-valuemin="0" aria-valuemax="{{max_count}}" style="width: {{ freq.count|divide:max_count|percentage}}">
          {{freq.count}}
        </div>
      </div>
    </td>
    <td>
      <a href="#" onclick="return popitup('{% url 'herring:lf_wizard_correction' object.id freq.length_bin.bin_length_cm freq.id %}','popoutWindow0')">
        <img src="{% static "/admin/img/icon-changelink.svg" %}" alt="">
      </a>
    </td>
  </tr>
  {% endfor %}
</table>
<br>
<p>
  <b>TOTAL COUNTS: {{sum_count}}</b>
</p>

{% endif %}




  <script type="text/javascript">
        // PREPARE THE STRING TO READ IN THE VIEW AND PASS AS CONTEXT...
      var playbackString = "{{playback_string}}"

      console.log(speechSynthesis.getVoices());
      $("#read-aloud").click(function() {
        var msg = new SpeechSynthesisUtterance();
        var voices = window.speechSynthesis.getVoices();
        console.log(voices);
        msg.voice = voices[0]; // Note: some voices don't support altering params
        msg.voiceURI = 'native';
        msg.volume = 1; // 0 to 1
        msg.rate = 1; // 0.1 to 10
        msg.pitch = 1; //0 to 2
        msg.text = playbackString;
        msg.lang = 'en-US';
        msg.onend = function(e) {
          console.log('Finished in ' + event.elapsedTime + ' seconds.');
        };

        speechSynthesis.speak(msg);
      })
  </script>
